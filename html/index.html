<!DOCTYPE html>
<!-- saved from url=(0127)https://docs.google.com/document/d/e/2PACX-1vTX5FpiDMdI6jx3GaQDsCNAyWdFLYiZMWjGqrM1rGHzvM9iFcpasuTbqZZpUcOALP-MjLCmUvagX2zr/pub -->
<html>
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
      <title>Account creation post purchase</title>
      <link rel="shortcut icon" href="https://ssl.gstatic.com/docs/documents/images/kix-favicon7.ico">
      <style type="text/css" nonce="">
         body {
         font-family: arial, sans, sans-serif;
         margin: 0;
         }
         iframe {
         border: 0;
         frameborder: 0;
         height: 100%;
         width: 100%;
         }
         #header, #footer {
         background: #f0f0f0;
         padding: 10px 10px;
         }
         #header {
         border-bottom: 1px #ccc solid;
         }
         #footer {
         border-top: 1px #ccc solid;
         border-bottom: 1px #ccc solid;
         font-size: 13;
         }
         #contents {
         margin: 6px;
         }
         .dash {
         padding: 0 6px;
         }
      </style>
      <style data-styled="" data-styled-version="4.3.2"></style>
      <script src="./Account creation post purchase_files/logger.min.js" async=""></script>
   </head>
   <body class="tw--">
      <div id="header">Account creation post purchase</div>
      <div id="contents">
         <style type="text/css">@import url('https://themes.googleusercontent.com/fonts/css?kit=cGvuclDC_Z1vE_cnVEU6AXViq0yED-ZxaBc9dvCrf1Sxpmtx-4eBcbXXZ5c-XOz8QmV6c0ZSd4rBpZL58Yv4WQ');ul.lst-kix_14nqgy1q2hqt-8{list-style-type:none}ul.lst-kix_14nqgy1q2hqt-0{list-style-type:none}ul.lst-kix_14nqgy1q2hqt-1{list-style-type:none}ul.lst-kix_14nqgy1q2hqt-2{list-style-type:none}ul.lst-kix_14nqgy1q2hqt-3{list-style-type:none}ul.lst-kix_p7ors6pjruu9-0{list-style-type:none}ul.lst-kix_14nqgy1q2hqt-4{list-style-type:none}ul.lst-kix_14nqgy1q2hqt-5{list-style-type:none}ul.lst-kix_p7ors6pjruu9-2{list-style-type:none}ul.lst-kix_14nqgy1q2hqt-6{list-style-type:none}ul.lst-kix_p7ors6pjruu9-1{list-style-type:none}ul.lst-kix_14nqgy1q2hqt-7{list-style-type:none}ul.lst-kix_p7ors6pjruu9-4{list-style-type:none}.lst-kix_v890rnyzzts-0>li:before{content:"\0025cf  "}ul.lst-kix_p7ors6pjruu9-3{list-style-type:none}ul.lst-kix_p7ors6pjruu9-6{list-style-type:none}.lst-kix_f01it4bmhw24-1>li:before{content:"\0025cb  "}ul.lst-kix_p7ors6pjruu9-5{list-style-type:none}ul.lst-kix_p7ors6pjruu9-8{list-style-type:none}.lst-kix_f01it4bmhw24-0>li:before{content:"\0025cf  "}.lst-kix_q658fpr24y9n-4>li{counter-increment:lst-ctn-kix_q658fpr24y9n-4}ul.lst-kix_p7ors6pjruu9-7{list-style-type:none}ol.lst-kix_yw5w9l6wccxd-4.start{counter-reset:lst-ctn-kix_yw5w9l6wccxd-4 0}.lst-kix_lmnq551zuub-1>li{counter-increment:lst-ctn-kix_lmnq551zuub-1}ul.lst-kix_v890rnyzzts-7{list-style-type:none}ul.lst-kix_v890rnyzzts-6{list-style-type:none}.lst-kix_lmnq551zuub-3>li{counter-increment:lst-ctn-kix_lmnq551zuub-3}ul.lst-kix_v890rnyzzts-8{list-style-type:none}ol.lst-kix_q658fpr24y9n-5.start{counter-reset:lst-ctn-kix_q658fpr24y9n-5 0}.lst-kix_yw5w9l6wccxd-0>li{counter-increment:lst-ctn-kix_yw5w9l6wccxd-0}.lst-kix_q658fpr24y9n-2>li{counter-increment:lst-ctn-kix_q658fpr24y9n-2}ul.lst-kix_v890rnyzzts-3{list-style-type:none}ul.lst-kix_v890rnyzzts-2{list-style-type:none}ul.lst-kix_v890rnyzzts-5{list-style-type:none}ul.lst-kix_v890rnyzzts-4{list-style-type:none}ul.lst-kix_v890rnyzzts-1{list-style-type:none}ul.lst-kix_v890rnyzzts-0{list-style-type:none}.lst-kix_lmnq551zuub-5>li{counter-increment:lst-ctn-kix_lmnq551zuub-5}ul.lst-kix_29kclqke2mop-8{list-style-type:none}ul.lst-kix_29kclqke2mop-7{list-style-type:none}.lst-kix_v890rnyzzts-8>li:before{content:"\0025a0  "}.lst-kix_yw5w9l6wccxd-5>li{counter-increment:lst-ctn-kix_yw5w9l6wccxd-5}.lst-kix_yw5w9l6wccxd-2>li{counter-increment:lst-ctn-kix_yw5w9l6wccxd-2}.lst-kix_v890rnyzzts-7>li:before{content:"\0025cb  "}ol.lst-kix_q658fpr24y9n-0.start{counter-reset:lst-ctn-kix_q658fpr24y9n-0 0}.lst-kix_v890rnyzzts-2>li:before{content:"\0025a0  "}.lst-kix_v890rnyzzts-1>li:before{content:"\0025cb  "}.lst-kix_v890rnyzzts-3>li:before{content:"\0025cf  "}.lst-kix_v890rnyzzts-4>li:before{content:"\0025cb  "}.lst-kix_v890rnyzzts-6>li:before{content:"\0025cf  "}.lst-kix_v890rnyzzts-5>li:before{content:"\0025a0  "}ol.lst-kix_q658fpr24y9n-6.start{counter-reset:lst-ctn-kix_q658fpr24y9n-6 0}.lst-kix_lmnq551zuub-8>li{counter-increment:lst-ctn-kix_lmnq551zuub-8}.lst-kix_yw5w9l6wccxd-4>li{counter-increment:lst-ctn-kix_yw5w9l6wccxd-4}ol.lst-kix_lmnq551zuub-3.start{counter-reset:lst-ctn-kix_lmnq551zuub-3 0}.lst-kix_lmnq551zuub-7>li{counter-increment:lst-ctn-kix_lmnq551zuub-7}ol.lst-kix_lmnq551zuub-6.start{counter-reset:lst-ctn-kix_lmnq551zuub-6 0}.lst-kix_29kclqke2mop-3>li:before{content:"-  "}.lst-kix_29kclqke2mop-7>li:before{content:"-  "}.lst-kix_29kclqke2mop-1>li:before{content:"-  "}ol.lst-kix_yw5w9l6wccxd-1{list-style-type:none}.lst-kix_yw5w9l6wccxd-3>li{counter-increment:lst-ctn-kix_yw5w9l6wccxd-3}ol.lst-kix_yw5w9l6wccxd-2{list-style-type:none}.lst-kix_lmnq551zuub-2>li:before{content:"" counter(lst-ctn-kix_lmnq551zuub-0,decimal) "." counter(lst-ctn-kix_lmnq551zuub-1,decimal) "." counter(lst-ctn-kix_lmnq551zuub-2,decimal) ". "}ol.lst-kix_yw5w9l6wccxd-0{list-style-type:none}ol.lst-kix_yw5w9l6wccxd-3.start{counter-reset:lst-ctn-kix_yw5w9l6wccxd-3 0}ol.lst-kix_yw5w9l6wccxd-5{list-style-type:none}.lst-kix_q658fpr24y9n-8>li{counter-increment:lst-ctn-kix_q658fpr24y9n-8}ol.lst-kix_yw5w9l6wccxd-6{list-style-type:none}ol.lst-kix_yw5w9l6wccxd-3{list-style-type:none}ol.lst-kix_yw5w9l6wccxd-4{list-style-type:none}.lst-kix_lmnq551zuub-4>li:before{content:"" counter(lst-ctn-kix_lmnq551zuub-0,decimal) "." counter(lst-ctn-kix_lmnq551zuub-1,decimal) "." counter(lst-ctn-kix_lmnq551zuub-2,decimal) "." counter(lst-ctn-kix_lmnq551zuub-3,decimal) "." counter(lst-ctn-kix_lmnq551zuub-4,decimal) ". "}.lst-kix_lmnq551zuub-6>li:before{content:"" counter(lst-ctn-kix_lmnq551zuub-0,decimal) "." counter(lst-ctn-kix_lmnq551zuub-1,decimal) "." counter(lst-ctn-kix_lmnq551zuub-2,decimal) "." counter(lst-ctn-kix_lmnq551zuub-3,decimal) "." counter(lst-ctn-kix_lmnq551zuub-4,decimal) "." counter(lst-ctn-kix_lmnq551zuub-5,decimal) "." counter(lst-ctn-kix_lmnq551zuub-6,decimal) ". "}.lst-kix_lmnq551zuub-6>li{counter-increment:lst-ctn-kix_lmnq551zuub-6}.lst-kix_29kclqke2mop-5>li:before{content:"-  "}ol.lst-kix_lmnq551zuub-5.start{counter-reset:lst-ctn-kix_lmnq551zuub-5 0}.lst-kix_lmnq551zuub-8>li:before{content:"" counter(lst-ctn-kix_lmnq551zuub-0,decimal) "." counter(lst-ctn-kix_lmnq551zuub-1,decimal) "." counter(lst-ctn-kix_lmnq551zuub-2,decimal) "." counter(lst-ctn-kix_lmnq551zuub-3,decimal) "." counter(lst-ctn-kix_lmnq551zuub-4,decimal) "." counter(lst-ctn-kix_lmnq551zuub-5,decimal) "." counter(lst-ctn-kix_lmnq551zuub-6,decimal) "." counter(lst-ctn-kix_lmnq551zuub-7,decimal) "." counter(lst-ctn-kix_lmnq551zuub-8,decimal) ". "}.lst-kix_p3pkczoti3si-0>li:before{content:"-  "}.lst-kix_p3pkczoti3si-2>li:before{content:"-  "}ol.lst-kix_yw5w9l6wccxd-6.start{counter-reset:lst-ctn-kix_yw5w9l6wccxd-6 0}ol.lst-kix_yw5w9l6wccxd-7{list-style-type:none}.lst-kix_p3pkczoti3si-6>li:before{content:"-  "}ol.lst-kix_yw5w9l6wccxd-8{list-style-type:none}ol.lst-kix_q658fpr24y9n-4.start{counter-reset:lst-ctn-kix_q658fpr24y9n-4 0}.lst-kix_p7ors6pjruu9-1>li:before{content:"-  "}.lst-kix_p3pkczoti3si-4>li:before{content:"-  "}ol.lst-kix_q658fpr24y9n-3{list-style-type:none}ol.lst-kix_q658fpr24y9n-4{list-style-type:none}.lst-kix_q658fpr24y9n-3>li{counter-increment:lst-ctn-kix_q658fpr24y9n-3}ol.lst-kix_q658fpr24y9n-5{list-style-type:none}ol.lst-kix_q658fpr24y9n-6{list-style-type:none}ol.lst-kix_yw5w9l6wccxd-5.start{counter-reset:lst-ctn-kix_yw5w9l6wccxd-5 0}ol.lst-kix_q658fpr24y9n-7{list-style-type:none}.lst-kix_f01it4bmhw24-8>li:before{content:"\0025a0  "}ol.lst-kix_q658fpr24y9n-8{list-style-type:none}ol.lst-kix_lmnq551zuub-4.start{counter-reset:lst-ctn-kix_lmnq551zuub-4 0}.lst-kix_p7ors6pjruu9-3>li:before{content:"-  "}ol.lst-kix_q658fpr24y9n-0{list-style-type:none}ol.lst-kix_q658fpr24y9n-1{list-style-type:none}ol.lst-kix_q658fpr24y9n-2{list-style-type:none}.lst-kix_p7ors6pjruu9-5>li:before{content:"-  "}.lst-kix_f01it4bmhw24-2>li:before{content:"\0025a0  "}ol.lst-kix_lmnq551zuub-8{list-style-type:none}ol.lst-kix_lmnq551zuub-7{list-style-type:none}.lst-kix_p3pkczoti3si-8>li:before{content:"-  "}ol.lst-kix_lmnq551zuub-6{list-style-type:none}.lst-kix_f01it4bmhw24-4>li:before{content:"\0025cb  "}.lst-kix_f01it4bmhw24-6>li:before{content:"\0025cf  "}ol.lst-kix_lmnq551zuub-1{list-style-type:none}ol.lst-kix_q658fpr24y9n-3.start{counter-reset:lst-ctn-kix_q658fpr24y9n-3 0}ol.lst-kix_lmnq551zuub-0{list-style-type:none}.lst-kix_p7ors6pjruu9-7>li:before{content:"-  "}ol.lst-kix_lmnq551zuub-5{list-style-type:none}ol.lst-kix_lmnq551zuub-4{list-style-type:none}ol.lst-kix_lmnq551zuub-3{list-style-type:none}ol.lst-kix_lmnq551zuub-2{list-style-type:none}.lst-kix_lmnq551zuub-2>li{counter-increment:lst-ctn-kix_lmnq551zuub-2}.lst-kix_14nqgy1q2hqt-0>li:before{content:"-  "}.lst-kix_14nqgy1q2hqt-1>li:before{content:"-  "}.lst-kix_14nqgy1q2hqt-3>li:before{content:"-  "}.lst-kix_q658fpr24y9n-3>li:before{content:"" counter(lst-ctn-kix_q658fpr24y9n-3,decimal) ". "}ol.lst-kix_yw5w9l6wccxd-1.start{counter-reset:lst-ctn-kix_yw5w9l6wccxd-1 0}.lst-kix_14nqgy1q2hqt-2>li:before{content:"-  "}.lst-kix_14nqgy1q2hqt-5>li:before{content:"-  "}.lst-kix_q658fpr24y9n-1>li:before{content:"" counter(lst-ctn-kix_q658fpr24y9n-1,lower-latin) ". "}.lst-kix_q658fpr24y9n-2>li:before{content:"" counter(lst-ctn-kix_q658fpr24y9n-2,lower-roman) ". "}.lst-kix_q658fpr24y9n-0>li:before{content:"" counter(lst-ctn-kix_q658fpr24y9n-0,decimal) ". "}ol.lst-kix_q658fpr24y9n-7.start{counter-reset:lst-ctn-kix_q658fpr24y9n-7 0}.lst-kix_14nqgy1q2hqt-4>li:before{content:"-  "}ol.lst-kix_q658fpr24y9n-2.start{counter-reset:lst-ctn-kix_q658fpr24y9n-2 0}.lst-kix_14nqgy1q2hqt-6>li:before{content:"-  "}.lst-kix_lmnq551zuub-0>li{counter-increment:lst-ctn-kix_lmnq551zuub-0}ol.lst-kix_yw5w9l6wccxd-7.start{counter-reset:lst-ctn-kix_yw5w9l6wccxd-7 0}.lst-kix_14nqgy1q2hqt-7>li:before{content:"-  "}.lst-kix_q658fpr24y9n-4>li:before{content:"" counter(lst-ctn-kix_q658fpr24y9n-4,lower-latin) ". "}.lst-kix_14nqgy1q2hqt-8>li:before{content:"-  "}.lst-kix_q658fpr24y9n-5>li:before{content:"" counter(lst-ctn-kix_q658fpr24y9n-5,lower-roman) ". "}.lst-kix_q658fpr24y9n-7>li:before{content:"" counter(lst-ctn-kix_q658fpr24y9n-7,lower-latin) ". "}.lst-kix_q658fpr24y9n-6>li:before{content:"" counter(lst-ctn-kix_q658fpr24y9n-6,decimal) ". "}.lst-kix_q658fpr24y9n-5>li{counter-increment:lst-ctn-kix_q658fpr24y9n-5}.lst-kix_q658fpr24y9n-8>li:before{content:"" counter(lst-ctn-kix_q658fpr24y9n-8,lower-roman) ". "}ol.lst-kix_lmnq551zuub-2.start{counter-reset:lst-ctn-kix_lmnq551zuub-2 0}ol.lst-kix_q658fpr24y9n-1.start{counter-reset:lst-ctn-kix_q658fpr24y9n-1 0}.lst-kix_q658fpr24y9n-1>li{counter-increment:lst-ctn-kix_q658fpr24y9n-1}.lst-kix_lmnq551zuub-0>li:before{content:"" counter(lst-ctn-kix_lmnq551zuub-0,decimal) ". "}ol.lst-kix_lmnq551zuub-8.start{counter-reset:lst-ctn-kix_lmnq551zuub-8 0}ol.lst-kix_lmnq551zuub-1.start{counter-reset:lst-ctn-kix_lmnq551zuub-1 0}.lst-kix_q658fpr24y9n-7>li{counter-increment:lst-ctn-kix_q658fpr24y9n-7}.lst-kix_yw5w9l6wccxd-8>li{counter-increment:lst-ctn-kix_yw5w9l6wccxd-8}.lst-kix_yw5w9l6wccxd-8>li:before{content:"" counter(lst-ctn-kix_yw5w9l6wccxd-8,lower-roman) ". "}.lst-kix_yw5w9l6wccxd-7>li:before{content:"" counter(lst-ctn-kix_yw5w9l6wccxd-7,lower-latin) ". "}.lst-kix_yw5w9l6wccxd-6>li:before{content:"" counter(lst-ctn-kix_yw5w9l6wccxd-6,decimal) ". "}.lst-kix_yw5w9l6wccxd-0>li:before{content:"" counter(lst-ctn-kix_yw5w9l6wccxd-0,decimal) ". "}ol.lst-kix_yw5w9l6wccxd-2.start{counter-reset:lst-ctn-kix_yw5w9l6wccxd-2 0}.lst-kix_yw5w9l6wccxd-1>li:before{content:"" counter(lst-ctn-kix_yw5w9l6wccxd-1,lower-latin) ". "}.lst-kix_yw5w9l6wccxd-2>li:before{content:"" counter(lst-ctn-kix_yw5w9l6wccxd-2,lower-roman) ". "}ol.lst-kix_yw5w9l6wccxd-8.start{counter-reset:lst-ctn-kix_yw5w9l6wccxd-8 0}.lst-kix_yw5w9l6wccxd-4>li:before{content:"" counter(lst-ctn-kix_yw5w9l6wccxd-4,lower-latin) ". "}.lst-kix_yw5w9l6wccxd-3>li:before{content:"" counter(lst-ctn-kix_yw5w9l6wccxd-3,decimal) ". "}.lst-kix_yw5w9l6wccxd-5>li:before{content:"" counter(lst-ctn-kix_yw5w9l6wccxd-5,lower-roman) ". "}ol.lst-kix_lmnq551zuub-7.start{counter-reset:lst-ctn-kix_lmnq551zuub-7 0}ol.lst-kix_lmnq551zuub-0.start{counter-reset:lst-ctn-kix_lmnq551zuub-0 0}ul.lst-kix_f01it4bmhw24-1{list-style-type:none}ul.lst-kix_f01it4bmhw24-2{list-style-type:none}ul.lst-kix_f01it4bmhw24-0{list-style-type:none}ul.lst-kix_f01it4bmhw24-5{list-style-type:none}ul.lst-kix_p3pkczoti3si-3{list-style-type:none}ul.lst-kix_29kclqke2mop-0{list-style-type:none}ul.lst-kix_f01it4bmhw24-6{list-style-type:none}ul.lst-kix_p3pkczoti3si-4{list-style-type:none}ul.lst-kix_f01it4bmhw24-3{list-style-type:none}ul.lst-kix_p3pkczoti3si-5{list-style-type:none}ul.lst-kix_29kclqke2mop-2{list-style-type:none}ul.lst-kix_f01it4bmhw24-4{list-style-type:none}ul.lst-kix_p3pkczoti3si-6{list-style-type:none}ul.lst-kix_29kclqke2mop-1{list-style-type:none}.lst-kix_29kclqke2mop-4>li:before{content:"-  "}.lst-kix_29kclqke2mop-6>li:before{content:"-  "}ul.lst-kix_29kclqke2mop-4{list-style-type:none}ul.lst-kix_p3pkczoti3si-0{list-style-type:none}ul.lst-kix_29kclqke2mop-3{list-style-type:none}ul.lst-kix_f01it4bmhw24-7{list-style-type:none}ul.lst-kix_p3pkczoti3si-1{list-style-type:none}ul.lst-kix_29kclqke2mop-6{list-style-type:none}ul.lst-kix_f01it4bmhw24-8{list-style-type:none}ul.lst-kix_p3pkczoti3si-2{list-style-type:none}ul.lst-kix_29kclqke2mop-5{list-style-type:none}.lst-kix_29kclqke2mop-0>li:before{content:"-  "}.lst-kix_29kclqke2mop-2>li:before{content:"-  "}.lst-kix_29kclqke2mop-8>li:before{content:"-  "}.lst-kix_lmnq551zuub-1>li:before{content:"" counter(lst-ctn-kix_lmnq551zuub-0,decimal) "." counter(lst-ctn-kix_lmnq551zuub-1,decimal) ". "}.lst-kix_lmnq551zuub-3>li:before{content:"" counter(lst-ctn-kix_lmnq551zuub-0,decimal) "." counter(lst-ctn-kix_lmnq551zuub-1,decimal) "." counter(lst-ctn-kix_lmnq551zuub-2,decimal) "." counter(lst-ctn-kix_lmnq551zuub-3,decimal) ". "}.lst-kix_yw5w9l6wccxd-6>li{counter-increment:lst-ctn-kix_yw5w9l6wccxd-6}.lst-kix_lmnq551zuub-5>li:before{content:"" counter(lst-ctn-kix_lmnq551zuub-0,decimal) "." counter(lst-ctn-kix_lmnq551zuub-1,decimal) "." counter(lst-ctn-kix_lmnq551zuub-2,decimal) "." counter(lst-ctn-kix_lmnq551zuub-3,decimal) "." counter(lst-ctn-kix_lmnq551zuub-4,decimal) "." counter(lst-ctn-kix_lmnq551zuub-5,decimal) ". "}ol.lst-kix_yw5w9l6wccxd-0.start{counter-reset:lst-ctn-kix_yw5w9l6wccxd-0 0}.lst-kix_lmnq551zuub-7>li:before{content:"" counter(lst-ctn-kix_lmnq551zuub-0,decimal) "." counter(lst-ctn-kix_lmnq551zuub-1,decimal) "." counter(lst-ctn-kix_lmnq551zuub-2,decimal) "." counter(lst-ctn-kix_lmnq551zuub-3,decimal) "." counter(lst-ctn-kix_lmnq551zuub-4,decimal) "." counter(lst-ctn-kix_lmnq551zuub-5,decimal) "." counter(lst-ctn-kix_lmnq551zuub-6,decimal) "." counter(lst-ctn-kix_lmnq551zuub-7,decimal) ". "}ol.lst-kix_q658fpr24y9n-8.start{counter-reset:lst-ctn-kix_q658fpr24y9n-8 0}.lst-kix_yw5w9l6wccxd-1>li{counter-increment:lst-ctn-kix_yw5w9l6wccxd-1}.lst-kix_p3pkczoti3si-1>li:before{content:"-  "}.lst-kix_yw5w9l6wccxd-7>li{counter-increment:lst-ctn-kix_yw5w9l6wccxd-7}.lst-kix_p3pkczoti3si-7>li:before{content:"-  "}.lst-kix_lmnq551zuub-4>li{counter-increment:lst-ctn-kix_lmnq551zuub-4}.lst-kix_p3pkczoti3si-5>li:before{content:"-  "}.lst-kix_p7ors6pjruu9-0>li:before{content:"-  "}ul.lst-kix_p3pkczoti3si-7{list-style-type:none}ul.lst-kix_p3pkczoti3si-8{list-style-type:none}.lst-kix_p3pkczoti3si-3>li:before{content:"-  "}.lst-kix_q658fpr24y9n-6>li{counter-increment:lst-ctn-kix_q658fpr24y9n-6}.lst-kix_q658fpr24y9n-0>li{counter-increment:lst-ctn-kix_q658fpr24y9n-0}.lst-kix_p7ors6pjruu9-2>li:before{content:"-  "}.lst-kix_p7ors6pjruu9-4>li:before{content:"-  "}.lst-kix_p7ors6pjruu9-6>li:before{content:"-  "}.lst-kix_f01it4bmhw24-3>li:before{content:"\0025cf  "}.lst-kix_p7ors6pjruu9-8>li:before{content:"-  "}.lst-kix_f01it4bmhw24-5>li:before{content:"\0025a0  "}.lst-kix_f01it4bmhw24-7>li:before{content:"\0025cb  "}ol{margin:0;padding:0}table td,table th{padding:0}.c24{border-right-style:solid;padding:5pt 5pt 5pt 5pt;border-bottom-color:#000000;border-top-width:0pt;border-right-width:0pt;border-left-color:#000000;vertical-align:top;border-right-color:#000000;border-left-width:0pt;border-top-style:solid;background-color:#333333;border-left-style:solid;border-bottom-width:0pt;width:468pt;border-top-color:#000000;border-bottom-style:solid}.c23{-webkit-text-decoration-skip:none;color:#1155cc;font-weight:400;text-decoration:underline;vertical-align:baseline;text-decoration-skip-ink:none;font-size:14pt;font-family:"Arial";font-style:normal}.c4{background-color:#ffffff;color:#262626;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:11pt;font-family:"Arial";font-style:normal}.c35{color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:16pt;font-family:"Arial";font-style:normal}.c37{color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:11pt;font-family:"Arial";font-style:italic}.c27{padding-top:18pt;padding-bottom:6pt;line-height:1.15;orphans:2;widows:2;text-align:left;height:16pt}.c48{margin-left:36pt;padding-top:0pt;padding-bottom:0pt;line-height:1.15;orphans:2;widows:2;text-align:right}.c36{margin-left:18pt;padding-top:3pt;padding-bottom:0pt;line-height:1.0;orphans:2;widows:2;text-align:left}.c3{color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:11pt;font-family:"Arial";font-style:normal}.c20{color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:26pt;font-family:"Arial";font-style:normal}.c33{color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:14pt;font-family:"Arial";font-style:italic}.c2{color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:9pt;font-family:"Arial";font-style:italic}.c53{padding-top:10pt;padding-bottom:4pt;line-height:1.0;orphans:2;widows:2;text-align:left}.c38{color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-family:"Arial";font-style:normal}.c42{padding-top:18pt;padding-bottom:6pt;line-height:1.15;orphans:2;widows:2;text-align:left}.c51{padding-top:0pt;padding-bottom:0pt;line-height:1.15;orphans:2;widows:2;text-align:right}.c0{padding-top:0pt;padding-bottom:0pt;line-height:1.15;orphans:2;widows:2;text-align:left}.c57{padding-top:20pt;padding-bottom:6pt;line-height:1.15;orphans:2;widows:2;text-align:center}.c46{padding-top:10pt;padding-bottom:0pt;line-height:1.0;orphans:2;widows:2;text-align:left}.c55{padding-top:0pt;padding-bottom:3pt;line-height:1.15;orphans:2;widows:2;text-align:center}.c28{padding-top:0pt;padding-bottom:0pt;line-height:1.15;orphans:2;widows:2;text-align:center}.c25{padding-top:4pt;padding-bottom:0pt;line-height:1.0;orphans:2;widows:2;text-align:left}.c21{background-color:#ffffff;text-decoration-skip-ink:none;-webkit-text-decoration-skip:none;color:#1155cc;text-decoration:underline}.c16{border-spacing:0;border-collapse:collapse;margin-right:auto}.c29{text-decoration:none;vertical-align:baseline;font-size:11pt;font-style:normal}.c17{padding-top:0pt;padding-bottom:0pt;line-height:1.15;text-align:left}.c7{background-color:#333333;font-family:"Consolas";color:#fcc28c;font-weight:400}.c41{text-decoration-skip-ink:none;-webkit-text-decoration-skip:none;color:#1155cc;text-decoration:underline}.c9{background-color:#333333;font-family:"Consolas";color:#62c8f3;font-weight:700}.c31{background-color:#333333;font-family:"Consolas";color:#d36363;font-weight:400}.c6{background-color:#333333;font-family:"Consolas";color:#ffffff;font-weight:400}.c44{background-color:#333333;font-family:"Consolas";color:#ade5fc;font-weight:400}.c5{background-color:#333333;font-family:"Consolas";color:#ffffaa;font-weight:400}.c10{background-color:#333333;font-family:"Consolas";color:#62c8f3;font-weight:400}.c18{background-color:#333333;font-family:"Consolas";color:#888888;font-weight:400}.c14{background-color:#333333;font-family:"Consolas";color:#a2fca2;font-weight:400}.c47{color:#999999;font-weight:400;font-family:"Arial"}.c8{background-color:#ffffff;font-style:italic;color:#262626}.c56{background-color:#ffffff;max-width:468pt;padding:72pt 72pt 72pt 72pt}.c32{color:inherit;text-decoration:inherit}.c34{padding:0;margin:0}.c45{color:#000000;font-family:"Arial"}.c54{text-indent:-9pt;margin-right:-18pt}.c43{margin-left:72pt;padding-left:0pt}.c19{margin-left:36pt;padding-left:0pt}.c12{background-color:#ffffff;color:#262626}.c15{font-weight:400;font-family:"Montserrat"}.c11{height:11pt}.c22{font-weight:700}.c40{font-size:9pt}.c52{font-size:14pt}.c1{page-break-after:avoid}.c50{font-size:20pt}.c13{height:0pt}.c49{text-indent:-18pt}.c26{font-size:18pt}.c30{font-family:"Montserrat"}.c39{font-style:italic}.title{padding-top:0pt;color:#000000;font-size:26pt;padding-bottom:3pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}.subtitle{padding-top:0pt;color:#666666;font-size:15pt;padding-bottom:16pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}li{color:#000000;font-size:11pt;font-family:"Arial"}p{margin:0;color:#000000;font-size:11pt;font-family:"Arial"}h1{padding-top:0pt;color:#000000;font-size:11pt;padding-bottom:0pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h2{padding-top:18pt;color:#000000;font-size:16pt;padding-bottom:6pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h3{padding-top:16pt;color:#434343;font-size:14pt;padding-bottom:4pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h4{padding-top:14pt;color:#666666;font-size:12pt;padding-bottom:4pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h5{padding-top:12pt;color:#666666;font-size:11pt;padding-bottom:4pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h6{padding-top:12pt;color:#666666;font-size:11pt;padding-bottom:4pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;font-style:italic;orphans:2;widows:2;text-align:left}</style>
         <div>
            <p class="c28"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 271.00px; height: 82.82px;"><img alt="" src="./Account creation post purchase_files/FastSpring_logo_print.jpg" style="width: 305.79px; height: 236.70px; margin-left: -16.17px; margin-top: -74.49px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p>
         </div>
         <p class="c48"><span class="c33">&nbsp;</span></p>
         <p class="c0 c11"><span class="c3"></span></p>
         <p class="c0 c11"><span class="c3"></span></p>
         <p class="c28"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 553.00px; height: 169.00px;"><img alt="" src="./Account creation post purchase_files/FastSpring_logo_print.jpg" style="width: 624.00px; height: 483.00px; margin-left: -33.00px; margin-top: -152.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p>
         <p class="c0 c11"><span class="c3"></span></p>
         <p class="c0 c11"><span class="c3"></span></p>
         <p class="c0 c11"><span class="c3"></span></p>
         <p class="c0 c11"><span class="c3"></span></p>
         <p class="c1 c55 title" id="h.pt31khbhhglo"><span class="c22 c30">PSI - Tutorial - Account creation after purchase</span></p>
         <p class="c0 c11"><span class="c3"></span></p>
         <p class="c0 c11"><span class="c3"></span></p>
         <p class="c0 c11"><span class="c3"></span></p>
         <p class="c0 c11"><span class="c3"></span></p>
         <p class="c0 c11"><span class="c3"></span></p>
         <p class="c0 c11"><span class="c3"></span></p>
         <p class="c0 c11"><span class="c3"></span></p>
         <p class="c0 c11"><span class="c3"></span></p>
         <p class="c0 c11"><span class="c3"></span></p>
         <p class="c0 c11"><span class="c3"></span></p>
         <p class="c0 c11"><span class="c3"></span></p>
         <p class="c0 c11"><span class="c3"></span></p>
         <p class="c0 c11"><span class="c3"></span></p>
         <p class="c0 c11"><span class="c3"></span></p>
         <p class="c0 c11"><span class="c3"></span></p>
         <p class="c0 c11"><span class="c3"></span></p>
         <p class="c0 c11"><span class="c3"></span></p>
         <p class="c28"><span class="c15">Questions? Contact </span><span class="c41 c15"><a class="c32" href="mailto:jtrujillo@fastspring.com">jtrujillo@fastspring.com</a></span></p>
         <p class="c0 c11"><span class="c3"></span></p>
         <h1 class="c1 c57" id="h.mcyrrxam1wqr"><span class="c15 c50">Table of Contents</span></h1>
         <p class="c0 c11"><span class="c3"></span></p>
         <p class="c0 c11"><span class="c3"></span></p>
         <p class="c0 c11"><span class="c3"></span></p>
         <p class="c25"><span class="c23"><a class="c32" href="https://docs.google.com/document/d/e/2PACX-1vTX5FpiDMdI6jx3GaQDsCNAyWdFLYiZMWjGqrM1rGHzvM9iFcpasuTbqZZpUcOALP-MjLCmUvagX2zr/pub#h.15myb88m345a">Abstract</a></span></p>
         <p class="c46"><span class="c23"><a class="c32" href="https://docs.google.com/document/d/e/2PACX-1vTX5FpiDMdI6jx3GaQDsCNAyWdFLYiZMWjGqrM1rGHzvM9iFcpasuTbqZZpUcOALP-MjLCmUvagX2zr/pub#h.kvnai0b8gvdj">High level overview</a></span></p>
         <p class="c46"><span class="c23"><a class="c32" href="https://docs.google.com/document/d/e/2PACX-1vTX5FpiDMdI6jx3GaQDsCNAyWdFLYiZMWjGqrM1rGHzvM9iFcpasuTbqZZpUcOALP-MjLCmUvagX2zr/pub#h.xi3vj01ovixt">Implementation</a></span></p>
         <p class="c36"><span class="c23"><a class="c32" href="https://docs.google.com/document/d/e/2PACX-1vTX5FpiDMdI6jx3GaQDsCNAyWdFLYiZMWjGqrM1rGHzvM9iFcpasuTbqZZpUcOALP-MjLCmUvagX2zr/pub#h.wpsga552jusb">1. Completing a purchase</a></span></p>
         <p class="c36"><span class="c23"><a class="c32" href="https://docs.google.com/document/d/e/2PACX-1vTX5FpiDMdI6jx3GaQDsCNAyWdFLYiZMWjGqrM1rGHzvM9iFcpasuTbqZZpUcOALP-MjLCmUvagX2zr/pub#h.1oi724n8ea9c">2. Using webhooks to create an account</a></span></p>
         <p class="c36"><span class="c41 c52"><a class="c32" href="https://docs.google.com/document/d/e/2PACX-1vTX5FpiDMdI6jx3GaQDsCNAyWdFLYiZMWjGqrM1rGHzvM9iFcpasuTbqZZpUcOALP-MjLCmUvagX2zr/pub#h.zmzdluk3kyg">3. Resetting user’s password</a></span></p>
         <p class="c53"><span class="c23"><a class="c32" href="https://docs.google.com/document/d/e/2PACX-1vTX5FpiDMdI6jx3GaQDsCNAyWdFLYiZMWjGqrM1rGHzvM9iFcpasuTbqZZpUcOALP-MjLCmUvagX2zr/pub#h.h0way9wbjhi5">Wrapping up</a></span></p>
         <p class="c0 c11"><span class="c3"></span></p>
         <p class="c0 c11"><span class="c3"></span></p>
         <hr style="page-break-before:always;display:none;">
         <p class="c0 c11"><span class="c3"></span></p>
         <p class="c0 c11"><span class="c3"></span></p>
         <p class="c0 c11"><span class="c3"></span></p>
         <h1 class="c0 c1" id="h.15myb88m345a"><span class="c38 c26">Abstract</span></h1>
         <p class="c0 c11"><span class="c3"></span></p>
         <p class="c0"><span>The aim of this tutorial is to explain one implementation of a common user case when purchasing a SaaS product: the creation of a user account after the purchase.</span><span>&nbsp;</span><span class="c3">SaaS solutions rely on online user authentication to use their products. More often than not, integrating your eCommerce platform with your user creation process in your backend can be painful or even not possible at all. </span></p>
         <p class="c0 c11"><span class="c3"></span></p>
         <p class="c0"><span>We will see how easy it is to achieve this process with FastSpring. We will leverage on standard JSON based webhooks and API calls to achieve a seamless integration so that buyers can start using the product as soon as they complete their purchase.<br></span></p>
         <p class="c0 c11"><span class="c3"></span></p>
         <hr style="page-break-before:always;display:none;">
         <p class="c0 c11"><span class="c3"></span></p>
         <h1 class="c0 c11 c1" id="h.kvnai0b8gvdj"><span class="c38 c26"></span></h1>
         <h1 class="c0 c1" id="h.37mmuuw2u20c"><span class="c26">High level overview</span><span class="c3">&nbsp;</span></h1>
         <p class="c0 c11"><span class="c3"></span></p>
         <p class="c0 c54"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 660.75px; height: 299.50px;"><img alt="" src="./Account creation post purchase_files/Account created post purchase (1).png" style="width: 660.75px; height: 299.50px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p>
         <p class="c0 c49"><span class="c39 c40">Standard FastSpring purchase process </span></p>
         <p class="c0 c11"><span class="c3"></span></p>
         <p class="c0"><span>The above diagram depicts the standard Buyer-Seller-FastSpring flow in a swim-lane diagram. </span><span>Let’s look at each step in more detail:</span></p>
         <ol class="c34 lst-kix_lmnq551zuub-0 start" start="1">
            <li class="c0 c19"><span class="c3">The Buyer visits storefront. The storefront pages hosted by the Seller displays products’ information using FastSpring SBL interface.</span></li>
            <li class="c0 c19"><span class="c3">After selecting one or more products, the Buyer hits the buy button which opens up the popup storefront.</span></li>
            <li class="c0 c19"><span class="c3">Inside the popup storefront hosted by FastSpring, the Buyer inputs their data and proceeds to checkout.</span></li>
            <li class="c0 c19"><span class="c3">If the order was successful three things occur almost simultaneously:</span></li>
         </ol>
         <ol class="c34 lst-kix_lmnq551zuub-1 start" start="1">
            <li class="c0 c43"><span class="c3">The “Thank you” popup appears.</span></li>
            <li class="c0 c43"><span>An order.completed webhook event is fired off</span><span class="c3">.</span></li>
            <li class="c0 c43"><span class="c3">Buyer receives an email with the fulfillment and receipt of the order.</span></li>
         </ol>
         <ol class="c34 lst-kix_lmnq551zuub-0" start="5">
            <li class="c0 c19"><span>From the JSON object within the webhook event we retrieve the customer data</span><span>&nbsp;and store it in our database.</span></li>
            <li class="c0 c19"><span class="c3">When the Buyer closes the Popup Thank you page, a callback function is triggered in the browser which contains the id and reference of the order. Then Seller then extracts the order ID and sends it to their backend.</span></li>
            <li class="c0 c19"><span>In the Seller's backend, given the order ID, the Seller makes use of the FastSpring API to get information about the order. The Seller checks the Buyer who made this transaction and checks in their own database whether it exists and does not have a password set yet.</span></li>
            <li class="c0 c19"><span>The Seller directs the Buyer</span><span>&nbsp;</span><span class="c3">to a new page where she can finish the account creation by offering her password.</span></li>
            <li class="c0 c19"><span class="c3">After storing the Buyer's password, the account is completely finished in the Seller's backend. Now the Buyer can login to use the newly purchased SaaS solution.</span></li>
         </ol>
         <p class="c0 c11"><span class="c3"></span></p>
         <p class="c0"><span>One thing to notice is that when the order is completed (step 4) the order.completed webhook </span><span>event </span><span>will be fired off. Most of the </span><span>time</span><span>, your server will receive this information almost instantly. However, </span><span>webhooks generation is </span><span class="c3">queued, which means that depending on the current workload of the FastSpring servers it may take a bit longer than usual to reach your backend. It’s for this reason that we wait until the user closes the popup to check our database. This gives us some extra time and provides an optimal user experience.</span></p>
         <p class="c0 c11"><span class="c3"></span></p>
         <p class="c0 c11"><span class="c3"></span></p>
         <h1 class="c0 c1" id="h.xi3vj01ovixt"><span class="c26">Implementation</span></h1>
         <p class="c0 c11"><span class="c3"></span></p>
         <p class="c0"><span class="c29 c45 c22">Prerequisites</span></p>
         <p class="c0"><span>For this specific tutorial </span><span>we will be doing the implementation in </span><span class="c41"><a class="c32" href="https://www.google.com/url?q=https://nodejs.org/en/&amp;sa=D&amp;ust=1572620697655000">Node</a></span><span>&nbsp;(“</span><span class="c39">&gt;=v11.0.0</span><span>”)</span><span>. For installing all the necessary third party modules we’ll be using the default Node package manager </span><span class="c41"><a class="c32" href="https://www.google.com/url?q=https://www.npmjs.com/&amp;sa=D&amp;ust=1572620697655000">npm</a></span><span class="c3">.</span></p>
         <p class="c0"><span>To keep things simple, we will use a plain JSON file to represent our database.</span></p>
         <p class="c0 c11"><span class="c3"></span></p>
         <p class="c0"><span class="c29 c22 c45">Implementation steps</span></p>
         <p class="c0"><span class="c3">We will divide the implementation in three phases:</span></p>
         <ol class="c34 lst-kix_yw5w9l6wccxd-0 start" start="1">
            <li class="c0 c19"><span class="c3">Completing a purchase: add the bare minimum code to complete a purchase in our test storefront.</span></li>
            <li class="c0 c19"><span class="c3">Using webhooks to create an account: set up an event listener to add a customer to our database.</span></li>
            <li class="c0 c19"><span class="c3">Resetting user’s password: based on data-callbacks we will redirect the user to a reset password page.</span></li>
         </ol>
         <p class="c0 c11"><span class="c3"></span></p>
         <p class="c0 c11"><span class="c3"></span></p>
         <p class="c0"><span>All the code is readily available in the following </span><span>repo</span><span>sitory</span><span class="c3">.</span></p>
         <p class="c0 c11"><span class="c3"></span></p>
         <p class="c0 c11"><span class="c3"></span></p>
         <h2 class="c42 c1" id="h.wpsga552jusb"><span>Phase </span><span>1. Completing a purchase</span></h2>
         <p class="c0 c11"><span class="c3"></span></p>
         <p class="c0"><span>I</span><span>n order to display the popup storefront to complete a purchase the page needs to be served over HTTP/S. </span><span>Let’s start by setting up a basic local server to act as the backend of our application. Create a folder for the project (e.g</span><span class="c39">&nbsp;FSAccountCreation</span><span>) and initialize it with npm:</span></p>
         <p class="c0 c11"><span class="c3"></span></p>
         <a id="t.ece25cdf6057916db1828d2021cac8d1eed8dd0e"></a><a id="t.0"></a>
         <table class="c16">
            <tbody>
               <tr class="c13">
                  <td class="c24" colspan="1" rowspan="1">
                     <p class="c17"><span class="c5">mkdir</span><span class="c6">&nbsp;FSAccountCreation &amp;&amp; </span><span class="c5">cd</span><span class="c6">&nbsp;FSAccountCreation &amp;&amp; npm init</span></p>
                  </td>
               </tr>
            </tbody>
         </table>
         <p class="c0 c11"><span class="c3"></span></p>
         <p class="c0"><span>We’ll be using the </span><span class="c41"><a class="c32" href="https://www.google.com/url?q=https://expressjs.com/&amp;sa=D&amp;ust=1572620697658000">Express</a></span><span class="c3">&nbsp;module to support our server:</span></p>
         <p class="c0 c11"><span class="c3"></span></p>
         <a id="t.f968174bf4a32ce0fad31aa67b157546ed41cb68"></a><a id="t.1"></a>
         <table class="c16">
            <tbody>
               <tr class="c13">
                  <td class="c24" colspan="1" rowspan="1">
                     <p class="c17"><span class="c6">npm install --</span><span class="c5">save</span><span class="c6">&nbsp;</span><span class="c5">express</span></p>
                  </td>
               </tr>
            </tbody>
         </table>
         <p class="c0 c11"><span class="c3"></span></p>
         <p class="c0 c11"><span class="c3"></span></p>
         <p class="c0"><span>Next, we’ll create our file </span><span class="c22">index.js </span><span>which will act as the entry point of our server. For now, it will only serve static files which will be located in a public folder that we create at the root directory.</span></p>
         <p class="c0 c11"><span class="c3"></span></p>
         <p class="c0 c11"><span class="c3"></span></p>
         <a id="t.502425665d24c2dd7071c231f42d6cd398404ac0"></a><a id="t.2"></a>
         <table class="c16">
            <tbody>
               <tr class="c13">
                  <td class="c24" colspan="1" rowspan="1">
                     <p class="c17"><span class="c7">const</span><span class="c6">&nbsp;express = require('express');<br><br><br></span><span class="c7">const</span><span class="c6">&nbsp;</span><span class="c7">app</span><span class="c6">&nbsp;= express();<br></span><span class="c7">app</span><span class="c6">.</span><span class="c7">use</span><span class="c6">(express.static('public'));<br><br></span><span class="c7">const</span><span class="c6">&nbsp;port = 3000;<br><br><br></span><span class="c7">app</span><span class="c6">.listen(port, () =&gt; console.</span><span class="c5">log</span><span class="c6">(`App successfully listening </span><span class="c7">on</span><span class="c6">&nbsp;port </span><span class="c44">${port}</span><span class="c6">!`));</span></p>
                  </td>
               </tr>
            </tbody>
         </table>
         <p class="c0 c11"><span class="c3"></span></p>
         <p class="c0"><span class="c3">Create the public folder:</span></p>
         <p class="c0 c11"><span class="c3"></span></p>
         <a id="t.c11558607b2f863f084c06a1095a4f023f62360d"></a><a id="t.3"></a>
         <table class="c16">
            <tbody>
               <tr class="c13">
                  <td class="c24" colspan="1" rowspan="1">
                     <p class="c17"><span class="c5">mkdir</span><span class="c6">&nbsp;</span><span class="c7">public</span></p>
                  </td>
               </tr>
            </tbody>
         </table>
         <p class="c0 c11"><span class="c3"></span></p>
         <p class="c0"><span>Inside the recently created </span><span>public folder,</span><span>&nbsp;add a file </span><span class="c22">store.html.</span><span class="c3">&nbsp;This file will hold the frontend of our storefront. For now we will add the bare minimum code:</span></p>
         <p class="c0 c11"><span class="c3"></span></p>
         <a id="t.503d4c3d13bfaf59876444f3e4bd5f1f7d55d5e4"></a><a id="t.4"></a>
         <table class="c16">
            <tbody>
               <tr class="c13">
                  <td class="c24" colspan="1" rowspan="1">
                     <p class="c17"><span class="c5">&lt;html&gt;</span><span class="c6"><br> &nbsp; &nbsp;</span><span class="c5">&lt;body&gt;</span><span class="c6"><br> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c5">Hello</span><span class="c6">&nbsp;there! Store in construction<br> &nbsp; &nbsp;</span><span class="c5">&lt;/body&gt;</span><span class="c6"><br></span><span class="c5">&lt;/html&gt;</span></p>
                  </td>
               </tr>
            </tbody>
         </table>
         <p class="c0 c11"><span class="c3"></span></p>
         <p class="c0 c11"><span class="c3"></span></p>
         <p class="c0"><span>Let’s test that our server is working fine. Execute the app by running </span><span class="c7">node</span><span class="c6">&nbsp;</span><span class="c5">index</span><span class="c6">.js</span><span>&nbsp;in the command line and open up </span><span class="c41"><a class="c32" href="https://www.google.com/url?q=http://localhost:3000/store.html&amp;sa=D&amp;ust=1572620697661000">http://localhost:3000/store.html</a></span><span class="c3">. You should see the following:</span></p>
         <p class="c0 c11"><span class="c3"></span></p>
         <p class="c0"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 355.00px; height: 107.00px;"><img alt="" src="./Account creation post purchase_files/Screenshot 2019-03-14 at 13.52.36.png" style="width: 355.00px; height: 107.00px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p>
         <p class="c0 c11"><span class="c3"></span></p>
         <p class="c0 c11"><span class="c3"></span></p>
         <p class="c0"><span>Now we’ll add our </span><span class="c41"><a class="c32" href="https://www.google.com/url?q=https://docs.fastspring.com/integrating-with-fastspring/store-builder-library&amp;sa=D&amp;ust=1572620697662000">Store Builder Library</a></span><span>&nbsp;to our </span><span class="c39">store.html</span><span>&nbsp;page. This will allow us to pull information about our products from our store and provide the popup checkout in order to complete the purchase. For this tutorial we are pointing to our official </span><span>FastSpring example store, which is documented here at the reference site </span><span class="c41"><a class="c32" href="https://www.google.com/url?q=https://www.fastspringexamples.com/&amp;sa=D&amp;ust=1572620697662000">fastspringexamples</a></span><span>. </span><span>In </span><span class="c3">your case, replace the data-storefront value to point to your store:</span></p>
         <p class="c0 c11"><span class="c3"></span></p>
         <a id="t.18035b96b7db2b1644fea6f27422b29a5c25029e"></a><a id="t.5"></a>
         <table class="c16">
            <tbody>
               <tr class="c13">
                  <td class="c24" colspan="1" rowspan="1">
                     <p class="c17"><span class="c6">&nbsp; &nbsp; </span><span class="c10">&lt;</span><span class="c9">script</span><span class="c10"><br> &nbsp; &nbsp; &nbsp; &nbsp;id=</span><span class="c14">"fsc-api"</span><span class="c10"><br> &nbsp; &nbsp; &nbsp; &nbsp;src=</span><span class="c14">"https://d1f8f9xcsvx3ha.cloudfront.net/sbl/0.7.9/fastspring-builder.min.js"</span><span class="c10"><br> &nbsp; &nbsp; &nbsp; &nbsp;type=</span><span class="c14">"text/javascript"</span><span class="c10"><br> &nbsp; &nbsp; &nbsp; &nbsp;data-storefront=</span><span class="c14">"fastspringexamples.test.onfastspring.com/popup-fastspringexamples"</span><span class="c10"><br> &nbsp; &nbsp;&gt;</span><span class="c6"><br> &nbsp; &nbsp;</span><span class="c10">&lt;/</span><span class="c9">script</span><span class="c10">&gt;</span></p>
                  </td>
               </tr>
            </tbody>
         </table>
         <p class="c0 c11"><span class="c3"></span></p>
         <p class="c0 c11"><span class="c3"></span></p>
         <p class="c0"><span>We’ll make use of the </span><span class="c41"><a class="c32" href="https://www.google.com/url?q=https://www.fastspringexamples.com/Actions/chainedaction&amp;sa=D&amp;ust=1572620697663000">data-fsc-action</a></span><span>&nbsp;HTML directive </span><span>to add one product</span><span>&nbsp;(“photo-io-main-app”) and launch</span><span>&nbsp;the popup checkout.</span><span class="c3">&nbsp;Once again, in your case choose one of your products already defined in the dashboard.</span></p>
         <p class="c0 c11"><span class="c3"></span></p>
         <p class="c0 c11"><span class="c3"></span></p>
         <p class="c0"><span>This is what we have so far in store.html:</span></p>
         <p class="c0 c11"><span class="c3"></span></p>
         <p class="c0 c11"><span class="c3"></span></p>
         <a id="t.022c8df669b83ddadea9cd6f3cae89784327a19e"></a><a id="t.6"></a>
         <table class="c16">
            <tbody>
               <tr class="c13">
                  <td class="c24" colspan="1" rowspan="1">
                     <p class="c17"><span class="c10">&lt;</span><span class="c9">html</span><span class="c10">&gt;</span><span class="c6"><br> &nbsp; &nbsp;</span><span class="c10">&lt;</span><span class="c9">script</span><span class="c10"><br> &nbsp; &nbsp; &nbsp; &nbsp;id=</span><span class="c14">"fsc-api"</span><span class="c10"><br> &nbsp; &nbsp; &nbsp; &nbsp;src=</span><span class="c14">"https://d1f8f9xcsvx3ha.cloudfront.net/sbl/0.7.9/fastspring-builder.min.js"</span><span class="c10"><br> &nbsp; &nbsp; &nbsp; &nbsp;type=</span><span class="c14">"text/javascript"</span><span class="c10"><br> &nbsp; &nbsp; &nbsp; &nbsp;data-storefront=</span><span class="c14">"fastspringexamples.test.onfastspring.com/popup-fastspringexamples"</span><span class="c10"><br> &nbsp; &nbsp;&gt;</span><span class="c6"><br> &nbsp; &nbsp;</span><span class="c10">&lt;/</span><span class="c9">script</span><span class="c10">&gt;</span><span class="c6"><br> &nbsp; &nbsp;</span><span class="c10">&lt;</span><span class="c9">body</span><span class="c10">&gt;</span><span class="c6"><br> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c10">&lt;</span><span class="c9">button</span><span class="c10">&nbsp;data-fsc-item-path-value=</span><span class="c14">"phot-io-main-app"</span><span class="c10">&nbsp;data-fsc-action=</span><span class="c14">'Add, Checkout'</span><span class="c10">&gt;</span><span class="c6">&nbsp;Buy </span><span class="c10">&lt;/</span><span class="c9">button</span><span class="c10">&gt;</span><span class="c6"><br> &nbsp; &nbsp;</span><span class="c10">&lt;/</span><span class="c9">body</span><span class="c10">&gt;</span><span class="c6"><br></span><span class="c10">&lt;/</span><span class="c9">html</span><span class="c10">&gt;</span></p>
                  </td>
               </tr>
            </tbody>
         </table>
         <p class="c0 c11"><span class="c3"></span></p>
         <p class="c0 c11"><span class="c3"></span></p>
         <p class="c0 c11"><span class="c3"></span></p>
         <p class="c0"><span>Now we can complete the purchase with the popup checkout. Reload the page and click on the buy button. When the popup displays you can complete a test order using</span><span>&nbsp;the f</span><span>ollowing test credit card details:</span></p>
         <ul class="c34 lst-kix_f01it4bmhw24-0 start">
            <li class="c0 c19"><span class="c3">Card Number: 4242 4242 4242 4242</span></li>
            <li class="c0 c19"><span class="c3">CVV code: *E4FP</span></li>
         </ul>
         <p class="c0 c11"><span class="c3"></span></p>
         <p class="c0 c11"><span class="c3"></span></p>
         <p class="c28"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 241.33px; height: 333.50px;"><img alt="" src="./Account creation post purchase_files/Screenshot 2019-03-07 at 10.16.34.png" style="width: 241.33px; height: 333.50px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p>
         <p class="c0 c11"><span class="c3"></span></p>
         <p class="c0 c11"><span class="c3"></span></p>
         <p class="c0"><span class="c3">After the order is completed you will see the Thank you popup:</span></p>
         <p class="c0 c11"><span class="c3"></span></p>
         <p class="c28"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 309.50px; height: 375.10px;"><img alt="" src="./Account creation post purchase_files/Screenshot 2019-04-10 at 10.47.00.png" style="width: 309.50px; height: 375.10px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p>
         <p class="c0 c11"><span class="c3"></span></p>
         <p class="c0 c11"><span class="c3"></span></p>
         <h2 class="c42 c1" id="h.1oi724n8ea9c"><span>Phase </span><span>2. Using webhooks to create an account</span></h2>
         <p class="c0"><span class="c3"><br>Now that we can complete a purchase, the next thing we want to do is to create an account in our backend so that the buyer can log into our system.</span></p>
         <p class="c0"><span>We will use the </span><span class="c41"><a class="c32" href="https://www.google.com/url?q=https://docs.fastspring.com/integrating-with-fastspring/webhooks/order-completed&amp;sa=D&amp;ust=1572620697667000">order.completed webhook</a></span><span>&nbsp;which is fired off every time a new purchase is completed</span><span>.</span><span>&nbsp;At FastSpring a</span><span>ccounts are uniquely</span><span class="c3">&nbsp;identified by their email address.</span></p>
         <p class="c0 c11"><span class="c3"></span></p>
         <p class="c0"><span>Webhooks’ information comes in JSON format. We need our server to be able to parse JSON </span><span>request</span><span>s correctly. Express comes with a built-in middleware </span><span>to do just that</span><span class="c3">, we just need to add the following line of code to our index.js file:</span></p>
         <p class="c0 c11"><span class="c3"></span></p>
         <a id="t.589cc6377f61722a49d837ba8780b0bca7d9923e"></a><a id="t.7"></a>
         <table class="c16">
            <tbody>
               <tr class="c13">
                  <td class="c24" colspan="1" rowspan="1">
                     <p class="c17"><span class="c7">app</span><span class="c44">.use</span><span class="c6">(</span><span class="c7">express</span><span class="c44">.json</span><span class="c6">());</span></p>
                  </td>
               </tr>
            </tbody>
         </table>
         <p class="c0 c11"><span class="c29 c6"></span></p>
         <p class="c0 c11"><span class="c29 c6"></span></p>
         <p class="c0"><span>FastSpring will send webhook information via POST HTTP method. We will start creating an endpoint called </span><span class="c22">processor</span><span>&nbsp;to process such information. For now it will just return a simple ‘Hello </span><span>World’ message:</span></p>
         <p class="c0 c11"><span class="c3"></span></p>
         <a id="t.101cd39a82a85e06ad24a2571e7b8d0a3a5f0d1f"></a><a id="t.8"></a>
         <table class="c16">
            <tbody>
               <tr class="c13">
                  <td class="c24" colspan="1" rowspan="1">
                     <p class="c17"><span class="c6">app.post(</span><span class="c14">'/processor'</span><span class="c6">, (req, res) =&gt; {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;res.send(</span><span class="c14">'Hello World!'</span><span class="c6">);<br>});</span></p>
                  </td>
               </tr>
            </tbody>
         </table>
         <p class="c0 c11"><span class="c3"></span></p>
         <p class="c0 c11"><span class="c3"></span></p>
         <p class="c0 c11"><span class="c3"></span></p>
         <p class="c0"><span>Let’s test that everything is working fine. </span><span>Restart your server</span><span>&nbsp;and send the following dummy request with </span><span>curl</span><span class="c3">&nbsp;command in the command line:</span></p>
         <p class="c0 c11"><span class="c3"></span></p>
         <a id="t.eb7887fdffa9e41e6dd002cdc3458f6b3f2e3c1d"></a><a id="t.9"></a>
         <table class="c16">
            <tbody>
               <tr class="c13">
                  <td class="c24" colspan="1" rowspan="1">
                     <p class="c17"><span class="c6">curl -d </span><span class="c14">'{}'</span><span class="c6">&nbsp;-X POST </span><span class="c14">http:</span><span class="c18">//localhost:3000/</span><span class="c18">processor</span></p>
                  </td>
               </tr>
            </tbody>
         </table>
         <p class="c0 c11"><span class="c3"></span></p>
         <p class="c0"><span class="c3">You should receive ‘Hello World’ as response.</span></p>
         <p class="c0 c11"><span class="c3"></span></p>
         <p class="c0"><span>Now that our endpoint is working we’ll </span><span>subscribe to the order.completed event in the FastSpring dashboard once our setup is completed.</span><span>&nbsp;First, we need to make </span><span>our local server publicly </span><span>accessible through an SSH tunnel. I like to use </span><span class="c41"><a class="c32" href="https://www.google.com/url?q=https://ngrok.com/&amp;sa=D&amp;ust=1572620697670000">ngrok</a></span><span>&nbsp;for that. Because our server is open at port 3000 let’s create a tunnel in t</span><span>hat port. In the command line enter:</span></p>
         <p class="c0 c11"><span class="c3"></span></p>
         <a id="t.6a634183b8482edcb146aad8df7ad5605394d901"></a><a id="t.10"></a>
         <table class="c16">
            <tbody>
               <tr class="c13">
                  <td class="c24" colspan="1" rowspan="1">
                     <p class="c17"><span class="c14">./ngrok</span><span class="c6">&nbsp;http 3000</span></p>
                  </td>
               </tr>
            </tbody>
         </table>
         <p class="c0 c11"><span class="c3"></span></p>
         <p class="c0"><span>Ngrok will return a random public address. In my case ‘</span><span class="c41"><a class="c32" href="https://www.google.com/url?q=https://c563f123.ngrok.io&amp;sa=D&amp;ust=1572620697670000">https://c563f123.ngrok.io</a></span><span class="c3">’. We’ll continue the tutorial using this address but remember to replace it with the one you got assigned.</span></p>
         <p class="c0 c11"><span class="c3"></span></p>
         <p class="c0"><span>It’s important that we always acknowledge the webhook, otherwise FastSpring will keep resending it over time to make sure you have processed it (</span><span>more information about marking a webhook as processed an webhook retries can be found </span><span class="c41"><a class="c32" href="https://www.google.com/url?q=https://docs.fastspring.com/integrating-with-fastspring/webhooks%23Webhooks-MarkingEventsasProcessed&amp;sa=D&amp;ust=1572620697671000">here</a></span><span class="c3">).</span></p>
         <p class="c0"><span>To </span><span>acknowledge a webhook has been received, we will wrap our code into a try/catch/finally block and always send a 200 HTTP status code in the end. For now we will just log the full request object to see what information we should get f</span><span>rom it:</span></p>
         <p class="c0 c11"><span class="c3"></span></p>
         <a id="t.41642562d0ca62aed67632fe58738ec1776c95db"></a><a id="t.11"></a>
         <table class="c16">
            <tbody>
               <tr class="c13">
                  <td class="c24" colspan="1" rowspan="1">
                     <p class="c17"><span class="c29 c6">const util = require('util'); //import util module</span></p>
                     <p class="c17"><span class="c29 c6">//...</span></p>
                     <p class="c11 c17"><span class="c29 c6"></span></p>
                     <p class="c17"><span class="c6">app.post(</span><span class="c14">'/processor'</span><span class="c29 c6">, (req, res) =&gt; {<br> &nbsp; &nbsp;try {</span></p>
                     <p class="c17"><span class="c6">&nbsp; &nbsp; &nbsp; &nbsp; console.log(util.inspect(req.body, false, null, true));<br> &nbsp; &nbsp;} </span><span class="c7">catch</span><span class="c6">&nbsp;(err) {<br> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c5">console</span><span class="c6">.log(</span><span class="c14">'An error has occurred while processing webhook: '</span><span class="c6">, err.message);<br> &nbsp; &nbsp;} </span><span class="c7">finally</span><span class="c6">&nbsp;{<br> &nbsp; &nbsp; &nbsp; &nbsp;res.sendStatus(</span><span class="c31">200</span><span class="c29 c6">);</span></p>
                     <p class="c17"><span class="c6">&nbsp; &nbsp; }<br>});</span></p>
                  </td>
               </tr>
            </tbody>
         </table>
         <p class="c0 c11"><span class="c3"></span></p>
         <p class="c0 c11"><span class="c3"></span></p>
         <p class="c0"><span>You can test that the SSH tunnel works by sending a request with an empty object to the public </span><span>address</span><span class="c3">. In the command line:</span></p>
         <p class="c0 c11"><span class="c3"></span></p>
         <a id="t.a18dce4f1c5e8ce9012dc8994dd42cf73701151f"></a><a id="t.12"></a>
         <table class="c16">
            <tbody>
               <tr class="c13">
                  <td class="c24" colspan="1" rowspan="1">
                     <p class="c17"><span class="c6">curl -d </span><span class="c14">'{}'</span><span class="c6">&nbsp;-X POST </span><span class="c14">https:</span><span class="c18">//c563f123.ngrok.io/processor</span></p>
                  </td>
               </tr>
            </tbody>
         </table>
         <p class="c0 c11"><span class="c3"></span></p>
         <p class="c0"><span class="c3">You will see the object {} being logged in your server’s process and a 200 OK status code as a response.</span></p>
         <p class="c0 c11"><span class="c3"></span></p>
         <p class="c0"><span>Now let’s go to our dashboard and subscribe to the order.completed webhook event in the FastSpring dashboard(for more about subscribing to webhooks visit </span><span class="c41"><a class="c32" href="https://www.google.com/url?q=https://docs.fastspring.com/integrating-with-fastspring/webhooks%23Webhooks-SettingUpWebhooks&amp;sa=D&amp;ust=1572620697674000">here</a></span><span class="c3">)</span></p>
         <p class="c0 c11"><span class="c3"></span></p>
         <p class="c0 c11"><span class="c3"></span></p>
         <p class="c0"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 588.00px; height: 297.00px;"><img alt="" src="./Account creation post purchase_files/Screenshot 2019-03-18 at 15.13.16.png" style="width: 588.00px; height: 297.00px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p>
         <p class="c0 c11"><span class="c3"></span></p>
         <p class="c0"><span class="c3">In the URL field we have specified the public address randomly assigned by ngrok. Once more, remember to change that with the one you have been assigned.</span></p>
         <p class="c0 c11"><span class="c3"></span></p>
         <p class="c0"><span>Let’s now test our webhook! To do that, we will complete a purchase with an </span><span>email address</span><span class="c3">&nbsp;we haven’t used yet in our system.</span></p>
         <p class="c28"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 248.78px; height: 421.50px;"><img alt="" src="./Account creation post purchase_files/Screenshot 2019-03-14 at 15.23.13.png" style="width: 248.78px; height: 421.50px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p>
         <p class="c0 c11"><span class="c3"></span></p>
         <p class="c0 c11"><span class="c3"></span></p>
         <p class="c0 c11"><span class="c3"></span></p>
         <p class="c0"><span>You should see the event information being logged in your server’s thread</span><span>:</span></p>
         <p class="c0 c11"><span class="c3"></span></p>
         <p class="c0 c11"><span class="c3"></span></p>
         <a id="t.ee1a92b4cbb550a30b8806088910d3a721d11d0b"></a><a id="t.13"></a>
         <table class="c16">
            <tbody>
               <tr class="c13">
                  <td class="c24" colspan="1" rowspan="1">
                     <p class="c17"><span class="c6">{<br> &nbsp; &nbsp;</span><span class="c14">"events"</span><span class="c6">: [<br> &nbsp; &nbsp; &nbsp; &nbsp;{<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c14">"id"</span><span class="c6">: </span><span class="c14">"RkJIuFQiRbuSkikOaQN3fQ"</span><span class="c6">,<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c14">"processed"</span><span class="c6">: </span><span class="c7">false</span><span class="c6">,<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c14">"created"</span><span class="c6">: </span><span class="c31">1551955974727</span><span class="c6">,<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c14">"type"</span><span class="c6">: </span><span class="c14">"order.completed"</span><span class="c6">,<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c14">"live"</span><span class="c6">: </span><span class="c7">false</span><span class="c6">,<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c14">"data"</span><span class="c6">: {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c14">"order"</span><span class="c6">: </span><span class="c14">"ALoHLQYESueh6RB9Fngu2A"</span><span class="c6">,<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c14">"id"</span><span class="c6">: </span><span class="c14">"ALoHLQYESueh6RB9Fngu2A"</span><span class="c6">,<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c14">"reference"</span><span class="c6">: </span><span class="c14">"JAVIERTRUJILLO190318-5365-39162"</span><span class="c6">,<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c14">"buyerReference"</span><span class="c6">: null,<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c14">"completed"</span><span class="c6">: </span><span class="c7">true</span><span class="c6">,<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c14">"changed"</span><span class="c6">: </span><span class="c31">1552921249720</span><span class="c6">,<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c14">"changedValue"</span><span class="c6">: </span><span class="c31">1552921249720</span><span class="c6">,<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c14">"changedInSeconds"</span><span class="c6">: </span><span class="c31">1552921249</span><span class="c6">,<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c14">"changedDisplay"</span><span class="c6">: </span><span class="c14">"18/03/19"</span><span class="c6">,<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c14">"language"</span><span class="c6">: </span><span class="c14">"en"</span><span class="c6">,<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c14">"live"</span><span class="c6">: </span><span class="c7">false</span><span class="c6">,<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c14">"currency"</span><span class="c6">: </span><span class="c14">"GBP"</span><span class="c6">,<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c14">"payoutCurrency"</span><span class="c6">: </span><span class="c14">"USD"</span><span class="c6">,<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c14">"invoiceUrl"</span><span class="c6">: </span><span class="c14">"https://javiertrujillo.test.onfastspring.com/account/order/JAVIERTRUJILLO190318-5365-39162/invoice"</span><span class="c6">,<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c14">"account"</span><span class="c6">: </span><span class="c14">"nX9n1B8MQ-WMczVhnebKBA"</span><span class="c6">,<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c14">"total"</span><span class="c6">: </span><span class="c31">5</span><span class="c6">,<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c14">"totalDisplay"</span><span class="c6">: </span><span class="c14">"£5.00"</span><span class="c6">,<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c14">"totalInPayoutCurrency"</span><span class="c6">: </span><span class="c31">6.42</span><span class="c6">,<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c14">"totalInPayoutCurrencyDisplay"</span><span class="c6">: </span><span class="c14">"USD"</span><span class="c6">,<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;...<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c14">"customer"</span><span class="c6">: {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c14">"first"</span><span class="c6">: </span><span class="c14">"cascdas"</span><span class="c6">,<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c14">"last"</span><span class="c6">: </span><span class="c14">"cdacdas"</span><span class="c6">,<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c14">"email"</span><span class="c6">: </span><span class="c14">"ha@fwa.com"</span><span class="c6">,<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c14">"company"</span><span class="c6">: null,<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c14">"phone"</span><span class="c6">: </span><span class="c14">"+31617282299"</span><span class="c6"><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;},<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;...<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp;]<br>}</span></p>
                  </td>
               </tr>
            </tbody>
         </table>
         <p class="c0 c11"><span class="c3"></span></p>
         <p class="c0 c11"><span class="c3"></span></p>
         <p class="c0"><span>We will use the account Id as the unique id to store the customer object which contains basic information about the buyer. </span></p>
         <p class="c0 c11"><span class="c3"></span></p>
         <p class="c0"><span>Now that we have verified that we are receiving webbook information in our endpoint, let’s add some logic to add new customers to our database. For our example w</span><span>e will just write </span><span>the data to</span><span>&nbsp;a file </span><span>on disk that will represent our database. </span><span>Create a file called </span><span class="c22">db.json</span><span>&nbsp;</span><span>inside a new folder </span><span class="c22">database</span><span>&nbsp;</span><span>in our root directory. This file should initially contain </span><span>just</span><span>&nbsp;an empty object</span><span>:</span></p>
         <p class="c0 c11"><span class="c3"><br></span></p>
         <a id="t.d76c8c37b1706143b026f041199ddfea9ab31d9f"></a><a id="t.14"></a>
         <table class="c16">
            <tbody>
               <tr class="c13">
                  <td class="c24" colspan="1" rowspan="1">
                     <p class="c17"><span class="c6">{}</span></p>
                  </td>
               </tr>
            </tbody>
         </table>
         <p class="c0 c11"><span class="c3"></span></p>
         <p class="c0 c11"><span class="c3"></span></p>
         <p class="c0"><span>We’ll also create a very simple util to act as the database driver. It will basically contain a couple of methods to read and write on the JSON file. Create a new folder </span><span class="c22">utils</span><span>&nbsp;</span><span>at the root directory with one file </span><span class="c29 c45 c22">DBdriver.js:</span></p>
         <p class="c0 c11"><span class="c3"></span></p>
         <a id="t.771dc17f60a6375d3631a6981cee42818ec31523"></a><a id="t.15"></a>
         <table class="c16">
            <tbody>
               <tr class="c13">
                  <td class="c24" colspan="1" rowspan="1">
                     <p class="c17"><span class="c7">const</span><span class="c6">&nbsp;path = </span><span class="c5">require</span><span class="c6">(</span><span class="c14">'path'</span><span class="c6">);<br></span><span class="c7">const</span><span class="c6">&nbsp;fs = </span><span class="c5">require</span><span class="c6">(</span><span class="c14">'fs'</span><span class="c6">);<br><br></span><span class="c7">const</span><span class="c6">&nbsp;dbLocation = path.resolve(__dirname, </span><span class="c14">'../database/db.json'</span><span class="c6">);<br><br></span><span class="c7">const</span><span class="c6">&nbsp;getContent = (() =&gt;<br> &nbsp; &nbsp;</span><span class="c5">JSON</span><span class="c6">.parse(fs.readFileSync(dbLocation, 'utf8'))<br>);<br><br>const writeContent = (content =&gt;<br> &nbsp; &nbsp;fs.writeFileSync(dbLocation, </span><span class="c5">JSON</span><span class="c6">.stringify(content, </span><span class="c7">null</span><span class="c6">, 4), 'utf8')<br>);<br><br><br>module.exports = {<br> &nbsp; &nbsp;getContent,<br> &nbsp; &nbsp;writeContent<br>};</span></p>
                  </td>
               </tr>
            </tbody>
         </table>
         <p class="c0 c11"><span class="c3"></span></p>
         <p class="c0 c11"><span class="c3"></span></p>
         <p class="c0"><span>Inside our processor endpoint</span><span>&nbsp;we’ll add the code needed to get the customer data from the order.completed event. As we just said, we know that the data will be under the </span><span class="c22">data.customer</span><span>&nbsp;object key. We will key our customers by their </span><span class="c22">account</span><span>I</span><span class="c3">d and add the customer information to that object.</span></p>
         <p class="c0 c11"><span class="c3"></span></p>
         <p class="c0 c11"><span class="c3"></span></p>
         <a id="t.aa15ae0d7f5c6828e1e07593093aedb4a98d3504"></a><a id="t.16"></a>
         <table class="c16">
            <tbody>
               <tr class="c13">
                  <td class="c24" colspan="1" rowspan="1">
                     <p class="c17"><span class="c29 c6">const DBdriver = require('./utils/DBdriver'); // add db util</span></p>
                     <p class="c17 c11"><span class="c29 c6"></span></p>
                     <p class="c17"><span class="c29 c6">//other requires…</span></p>
                     <p class="c17 c11"><span class="c29 c6"></span></p>
                     <p class="c17"><span class="c29 c18">/* POST /processor</span></p>
                     <p class="c17"><span class="c18">&nbsp;* Processes order.completed FastSpring webhook to add buyer's account information</span><span class="c6"><br></span><span class="c18">&nbsp;* to database.</span><span class="c6"><br></span><span class="c18">&nbsp;*</span><span class="c6"><br></span><span class="c18">&nbsp;* @param {Object} - order.completed event https://docs.fastspring.com/integrating-with-fastspring/webhooks/order-completed</span><span class="c6"><br></span><span class="c18">&nbsp;* @returns {number} - Acknowledge event with 200 HTTP status code</span><span class="c6"><br></span><span class="c18">&nbsp;*/</span><span class="c6"><br></span><span class="c7">app</span><span class="c6">.</span><span class="c7">post</span><span class="c6">('/processor', (req, res) =&gt; {<br> &nbsp; &nbsp;try {<br> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c18">// Check that request contains an events object</span><span class="c6"><br> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c7">if</span><span class="c6">&nbsp;(req.body &amp;&amp; Array.isArray(req.body.events)) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;req.body.events.</span><span class="c7">forEach</span><span class="c6">((event) =&gt; {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c18">// Only process order.completed events</span><span class="c6"><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c18">// Check that the order was successfully completed</span><span class="c6"><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c7">if</span><span class="c6">&nbsp;(event.</span><span class="c7">type</span><span class="c6">&nbsp;=== '</span><span class="c7">order</span><span class="c6">.completed' &amp;&amp; event.data.completed) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c18">// Get FastSpring assigned accountId</span><span class="c6"><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c7">const</span><span class="c6">&nbsp;accountId = event.data.account;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c18">// Let's check that this user is not already in our database</span><span class="c6"><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c7">const</span><span class="c6">&nbsp;dbContent = DBdriver.getContent();<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c7">if</span><span class="c6">&nbsp;(Object.keys(dbContent).indexOf(accountId) &lt; 0) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c18">// Add new user to our database file</span><span class="c6"><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;dbContent[accountId] = event.data.customer;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;DBdriver.writeContent(dbContent);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;});<br> &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp;} catch (</span><span class="c7">err</span><span class="c6">) {<br> &nbsp; &nbsp; &nbsp; &nbsp;console.</span><span class="c5">log</span><span class="c6">('</span><span class="c7">An</span><span class="c6">&nbsp;</span><span class="c7">error</span><span class="c6">&nbsp;has occurred </span><span class="c7">while</span><span class="c6">&nbsp;processing webhook: ', </span><span class="c7">err</span><span class="c6">.message);<br> &nbsp; &nbsp;} finally {<br> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c18">// Always make sure to acknowledge event</span><span class="c29 c6"><br> &nbsp; &nbsp; &nbsp; &nbsp;res.sendStatus(200);<br> &nbsp; &nbsp;}<br>});</span></p>
                  </td>
               </tr>
            </tbody>
         </table>
         <p class="c0 c11"><span class="c3"></span></p>
         <p class="c0 c11"><span class="c3"></span></p>
         <p class="c0"><span>Let’s test it out! </span><span>Restart the server</span><span>&nbsp;and complete a new purchase with an email address you haven’t used previously. Now if you look at the db.json file a new entry will have been added: </span><span>entry in your database:</span></p>
         <p class="c0 c11"><span class="c3"></span></p>
         <a id="t.b9bd97b83579c3968c58cfa8899b9076e8d6bb38"></a><a id="t.17"></a>
         <table class="c16">
            <tbody>
               <tr class="c13">
                  <td class="c24" colspan="1" rowspan="1">
                     <p class="c17"><span class="c6">{<br> &nbsp; &nbsp;"</span><span class="c14">nX9n1B8MQ-WMczVhnebKBA</span><span class="c6">": {<br> &nbsp; &nbsp; &nbsp; &nbsp;"first": </span><span class="c14">"John"</span><span class="c6">,</span><span class="c6"><br></span><span class="c6">&nbsp; &nbsp; &nbsp; &nbsp; "last": </span><span class="c14">"Doe"</span><span class="c6">,<br> &nbsp; &nbsp; &nbsp; &nbsp;"email": </span><span class="c14">"johndoe2@somedomain.com"</span><span class="c6">,<br> &nbsp; &nbsp; &nbsp; &nbsp;"company": </span><span class="c7">null</span><span class="c6">,<br> &nbsp; &nbsp; &nbsp; &nbsp;"phone": </span><span class="c7">null</span><span class="c6"><br> &nbsp; &nbsp;}<br>}</span></p>
                  </td>
               </tr>
            </tbody>
         </table>
         <p class="c0 c11"><span class="c3"></span></p>
         <p class="c0 c11"><span class="c3"></span></p>
         <h2 class="c1 c27" id="h.haazij1fhmmu"><span class="c35"></span></h2>
         <h2 class="c1 c42" id="h.zmzdluk3kyg"><span>Phase </span><span>3. Resetting user’s password</span></h2>
         <p class="c0 c11"><span class="c3"></span></p>
         <p class="c0"><span class="c3">Now that we are capable of adding new customers to our database the last step is to redirect them to a page where they can complete their account on our site by setting a password.</span></p>
         <p class="c0"><span>We do this once the user closes the popup checkout after completing the purchase. When that happens the </span><span class="c21 c22"><a class="c32" href="https://www.google.com/url?q=https://docs.fastspring.com/integrating-with-fastspring/store-builder-library/getting-started-with-store-builder-library&amp;sa=D&amp;ust=1572620697686000">data-popup-closed</a></span><span class="c12 c22">&nbsp;</span><span class="c12">event is fired. This callback contains the id and reference of the order just being made. We will store the orderId back to our backend. Next via the FastSpring API we check whether the customer is already in our database and has a password set</span><span class="c12">.</span><span class="c12">&nbsp;If it does, we will redirect her to their account </span><span class="c12">page; </span><span class="c4">if it doesn’t we will redirect her to a page where she can set the password.</span></p>
         <p class="c0 c11"><span class="c4"></span></p>
         <p class="c0"><span class="c12">Let’s start by adding the </span><span class="c12 c22">data-popup-closed </span><span class="c12">callback function in the browser (you can see a more detailed explanation in </span><span class="c21"><a class="c32" href="https://www.google.com/url?q=https://docs.fastspring.com/storefronts/popup-storefronts-on-your-website/redirecting-to-a-custom-page-following-popup-storefront-order-completion&amp;sa=D&amp;ust=1572620697686000">this article</a></span><span class="c4">).</span></p>
         <p class="c0 c11"><span class="c4"></span></p>
         <p class="c0"><span class="c12">We n</span><span class="c12">eed to add the callback to our SBL script in the store.html file:</span></p>
         <p class="c0 c11"><span class="c4"></span></p>
         <a id="t.a15c4faeabacd81816fdc23cfb10a27002006e7c"></a><a id="t.18"></a>
         <table class="c16">
            <tbody>
               <tr class="c13">
                  <td class="c24" colspan="1" rowspan="1">
                     <p class="c17"><span class="c6">data-popup-closed=</span><span class="c14">"onPopupClose"</span></p>
                  </td>
               </tr>
            </tbody>
         </table>
         <p class="c0 c11"><span class="c4"></span></p>
         <p class="c0"><span class="c12">Because this callback function is called every time the user closes the popup, we need to make sure that the order was successfully completed prior to that. </span><span class="c12">We achieve that by checking whether the orderReference argument exists. </span><span class="c12">F</span><span class="c12">rom that object, we’ll get the orderId</span><span class="c12">&nbsp;and make an </span><span class="c21"><a class="c32" href="https://www.google.com/url?q=https://developer.mozilla.org/en-US/docs/Web/Guide/AJAX/Getting_Started&amp;sa=D&amp;ust=1572620697687000">AJAX call</a></span><span class="c12">&nbsp;to our to our new endpoint </span><span class="c8">/checkOrder/[orderId]</span><span class="c4">&nbsp;(yet to be created).</span></p>
         <p class="c0 c11"><span class="c4"></span></p>
         <a id="t.481ec0aa031b761f1c976427ca88f091e4bf334e"></a><a id="t.19"></a>
         <table class="c16">
            <tbody>
               <tr class="c13">
                  <td class="c24" colspan="1" rowspan="1">
                     <p class="c17"><span class="c6">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c10">&lt;</span><span class="c9">script</span><span class="c10">&nbsp;type=</span><span class="c14">"text/javascript"</span><span class="c10">&gt;</span><span class="c6"><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c7">function</span><span class="c6">&nbsp;</span><span class="c5">onPopupClose</span><span class="c6">(orderReference) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c18">// Make sure an order has been completed</span><span class="c6"><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c7">if</span><span class="c6">&nbsp;(orderReference) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;fastspring.builder.reset();<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c18">// Create AJAX request with orderId</span><span class="c6"><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c7">const</span><span class="c6">&nbsp;Http = </span><span class="c7">new</span><span class="c6">&nbsp;XMLHttpRequest();<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c7">const</span><span class="c6">&nbsp;url= </span><span class="c14">`/checkorder/${orderReference.id}`</span><span class="c6">;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Http.open(</span><span class="c14">'GET'</span><span class="c6">, url);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Http.onreadystatechange = </span><span class="c7">function</span><span class="c6">() {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c18">// Check response is correct and parse the receiving JSON</span><span class="c6"><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c7">if</span><span class="c6">&nbsp;(</span><span class="c7">this</span><span class="c6">.readyState === </span><span class="c31">4</span><span class="c6">&nbsp;&amp;&amp; </span><span class="c7">this</span><span class="c6">.status === </span><span class="c31">200</span><span class="c6">) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c7">const</span><span class="c6">&nbsp;res = </span><span class="c5">JSON</span><span class="c6">.parse(</span><span class="c7">this</span><span class="c6">.responseText);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c7">if</span><span class="c6">&nbsp;(res &amp;&amp; res.success) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c5">window</span><span class="c29 c6">.location.href = res.redirect;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;} else {</span></p>
                     <p class="c17"><span class="c29 c6">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; alert('Buyer not found!');</span></p>
                     <p class="c17"><span class="c6">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;};<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Http.send();<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br><br> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c10">&lt;/</span><span class="c9">script</span><span class="c10">&gt;</span></p>
                  </td>
               </tr>
            </tbody>
         </table>
         <p class="c0 c11"><span class="c4"></span></p>
         <p class="c0 c11"><span class="c4"></span></p>
         <p class="c0"><span class="c12">Next, we create our endpoint. This endpoint will receive the id of the order as a parameter in the url and retrieve the customer associated via the </span><span class="c21"><a class="c32" href="https://www.google.com/url?q=https://docs.fastspring.com/integrating-with-fastspring/fastspring-api/orders&amp;sa=D&amp;ust=1572620697690000">/orders FastSpring endpoint</a></span><span class="c12">. We will create another module under the </span><span class="c8">utils</span><span class="c12">&nbsp;folder, called </span><span class="c8">FSApi.js</span><span class="c12">, to perform GET requests to the FastSpring API. For that we will use the </span><span class="c21"><a class="c32" href="https://www.google.com/url?q=https://www.npmjs.com/package/request-promise&amp;sa=D&amp;ust=1572620697690000">request-promise</a></span><span class="c4">&nbsp;module but you can of course use whichever other module you feel more comfortable with. Inside the command line run:</span></p>
         <p class="c0 c11"><span class="c4"></span></p>
         <a id="t.34c36532f621724695e1d668837490a1b2cea374"></a><a id="t.20"></a>
         <table class="c16">
            <tbody>
               <tr class="c13">
                  <td class="c24" colspan="1" rowspan="1">
                     <p class="c17"><span class="c6">npm </span><span class="c7">install</span><span class="c6">&nbsp;</span><span class="c18">--save request request-promise</span></p>
                  </td>
               </tr>
            </tbody>
         </table>
         <p class="c0 c11"><span class="c4"></span></p>
         <p class="c0"><span class="c12">Inside our utils/FSApi.js file add the following code (m</span><span class="c12">ake sure you replace the </span><span class="c21"><a class="c32" href="https://www.google.com/url?q=https://docs.fastspring.com/integrating-with-fastspring/fastspring-api%23FastSpringAPI-accessing&amp;sa=D&amp;ust=1572620697691000">API credentials</a></span><span class="c12">&nbsp;with your own ones in order to interact with your store</span><span class="c4">):</span></p>
         <p class="c0 c11"><span class="c4"></span></p>
         <a id="t.16ac56dde0c53c16dd6e5901174c49f8c5b8432d"></a><a id="t.21"></a>
         <table class="c16">
            <tbody>
               <tr class="c13">
                  <td class="c24" colspan="1" rowspan="1">
                     <p class="c17"><span class="c7">const</span><span class="c6">&nbsp;request = </span><span class="c5">require</span><span class="c6">(</span><span class="c14">'request-promise'</span><span class="c6">);<br><br></span><span class="c18">// Replace with your own credentials!</span><span class="c6"><br></span><span class="c7">const</span><span class="c6">&nbsp;</span><span class="c6">FS_CREDENTIALS</span><span class="c6">&nbsp;= {<br> &nbsp; &nbsp;username: </span><span class="c14">'NHOLARM9RPSQFRANIDPLZG'</span><span class="c6">,<br> &nbsp; &nbsp;password: </span><span class="c14">'gJ16aUlHSgqAo4BPuKHS6g'</span><span class="c6">,<br>};<br><br></span><span class="c7">const</span><span class="c6">&nbsp;</span><span class="c7">get</span><span class="c6">&nbsp;= (params) =&gt; {<br> &nbsp; &nbsp;</span><span class="c7">let</span><span class="c6">&nbsp;uri = </span><span class="c14">'https://api.fastspring.com'</span><span class="c6">;<br> &nbsp; &nbsp;</span><span class="c7">if</span><span class="c6">&nbsp;(params) {<br> &nbsp; &nbsp; &nbsp; &nbsp;uri = </span><span class="c14">`${uri}${params}`</span><span class="c6">;<br> &nbsp; &nbsp;}<br><br> &nbsp; &nbsp;</span><span class="c7">const</span><span class="c6">&nbsp;options = {<br> &nbsp; &nbsp; &nbsp; &nbsp;uri,<br> &nbsp; &nbsp; &nbsp; &nbsp;method: </span><span class="c14">'GET'</span><span class="c6">,<br> &nbsp; &nbsp; &nbsp; &nbsp;auth: {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;user: FS_CREDENTIALS.username,<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;pass: FS_CREDENTIALS.password<br> &nbsp; &nbsp; &nbsp; &nbsp;},<br> &nbsp; &nbsp; &nbsp; &nbsp;json: </span><span class="c7">true</span><span class="c6"><br> &nbsp; &nbsp;};<br> &nbsp; &nbsp;</span><span class="c7">return</span><span class="c6">&nbsp;request(options).catch((err) =&gt; {<br> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c5">console</span><span class="c6">.log(</span><span class="c14">'Request error '</span><span class="c6 c29">, err.message);<br> &nbsp; &nbsp;});<br>};</span></p>
                     <p class="c17 c11"><span class="c29 c6"></span></p>
                     <p class="c17"><span class="c29 c6">module.exports = { get };</span></p>
                  </td>
               </tr>
            </tbody>
         </table>
         <p class="c0 c11"><span class="c4"></span></p>
         <p class="c0 c11"><span class="c4"></span></p>
         <p class="c0"><span class="c12">Now we can create our endpoint using this util. Given the orderID param provided i</span><span class="c12">n the </span><span class="c4">url: we will query the FastSpring Order API passing in this orderID; retrieve all the order’s details; check in our database if the associate account ID exists; and decide whether we should redirect the user to the /account or /password page based on their password.</span></p>
         <p class="c0"><span class="c4">In case we are redirecting the user to the password page, we will send the accountId as a URL parameter. This will allow us to identify for whom the password will be set in the next step. As a reminder, passing in the information this way as well as not having any security checks on the endpoints is definitely not the way to go when considering a production environment. For the purpose of this tutorial it works since we can showcase an example implementation.</span></p>
         <p class="c0 c11"><span class="c4"></span></p>
         <p class="c0"><span class="c12">Start importing the FSApi module</span><span class="c4">&nbsp;in our index.js file:</span></p>
         <p class="c0 c11"><span class="c4"></span></p>
         <a id="t.008d8ca9015f1686775651fd6b0880002b85434a"></a><a id="t.22"></a>
         <table class="c16">
            <tbody>
               <tr class="c13">
                  <td class="c24" colspan="1" rowspan="1">
                     <p class="c17"><span class="c5">const FSApi</span><span class="c6">&nbsp;= require(</span><span class="c14">'./utils/FSApi'</span><span class="c6">);</span></p>
                  </td>
               </tr>
            </tbody>
         </table>
         <p class="c0 c11"><span class="c4"></span></p>
         <p class="c0"><span class="c12">Then we can add the endpoint:</span></p>
         <p class="c0 c11"><span class="c4"></span></p>
         <a id="t.90b9860a7760c519cf67253d90fbf6b28d138e83"></a><a id="t.23"></a>
         <table class="c16">
            <tbody>
               <tr class="c13">
                  <td class="c24" colspan="1" rowspan="1">
                     <p class="c17"><span class="c18">/* GET /checkorder/:orderId<br> * Check an order using the FastSpring API to retrieve buyer's information. Redirect to setPassword or account<br> * page depending on whether the buyer already has a password in our site.<br> *<br> * @param {String} - orderId<br> * @returns {Object} - Redirect user to new page based on its password<br> */</span><span class="c6"><br>app.get(</span><span class="c14">'/checkorder/:orderId'</span><span class="c6">, (req, res) =&gt; {<br> &nbsp; &nbsp;</span><span class="c7">try</span><span class="c6">&nbsp;{<br> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c18">// Get orderId from request params</span><span class="c6"><br> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c7">const</span><span class="c6">&nbsp;{ orderId } = req.params;<br> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c7">if</span><span class="c6">&nbsp;(!orderId) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c7">throw</span><span class="c6">&nbsp;</span><span class="c7">new</span><span class="c6">&nbsp;</span><span class="c5">Error</span><span class="c6">(</span><span class="c14">'No order Id found in request'</span><span class="c6">);<br> &nbsp; &nbsp; &nbsp; &nbsp;}<br><br> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c18">// Retrieve order from FastSpring API</span><span class="c6"><br> &nbsp; &nbsp; &nbsp; &nbsp;FSApi.get(</span><span class="c14">`/orders/${orderId}`</span><span class="c6">).then((order) =&gt; {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c7">if</span><span class="c6">&nbsp;(!order) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c7">throw</span><span class="c6">&nbsp;</span><span class="c7">new</span><span class="c6">&nbsp;</span><span class="c5">Error</span><span class="c6">(</span><span class="c14">'Order not found'</span><span class="c6">);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c18">// Check in database if buyer is in our database</span><span class="c6"><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c7">const</span><span class="c6">&nbsp;accountId = order.account;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c7">const</span><span class="c6">&nbsp;dbContent = DBdriver.getContent();<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c7">if</span><span class="c6">&nbsp;(!dbContent[accountId]) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c7">throw</span><span class="c6">&nbsp;</span><span class="c7">new</span><span class="c6">&nbsp;</span><span class="c5">Error</span><span class="c6">(</span><span class="c14">'User not found'</span><span class="c6">);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c18">// User exists, check whether user has already set a password</span><span class="c6"><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c7">if</span><span class="c6">&nbsp;(dbContent[accountId].password) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c18">// User is already registered, redirect to its account</span><span class="c6"><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c7">return</span><span class="c6">&nbsp;res.json({ success: </span><span class="c7">true</span><span class="c6">, redirect: </span><span class="c14">`/account.html?accountId=${accountId}`</span><span class="c6">&nbsp;});<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c18">// User does not have a password yet</span><span class="c6"><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c18">// Redirect to password page</span><span class="c6"><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c7">return</span><span class="c6">&nbsp;res.json({ success: </span><span class="c7">true</span><span class="c6">, redirect: </span><span class="c14">`/password.html?accountId=${accountId}`</span><span class="c6">&nbsp;});<br> &nbsp; &nbsp; &nbsp; &nbsp;});<br> &nbsp; &nbsp;} </span><span class="c7">catch</span><span class="c6">&nbsp;(err) {<br> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c5">console</span><span class="c6">.log(</span><span class="c14">'An error has occurred while checking order: '</span><span class="c6">, err.message);<br> &nbsp; &nbsp; &nbsp; &nbsp;res.json({ success: </span><span class="c7">false</span><span class="c6">, error: err.message });<br> &nbsp; &nbsp;}<br>});</span></p>
                  </td>
               </tr>
            </tbody>
         </table>
         <p class="c0 c11"><span class="c4"></span></p>
         <p class="c0 c11"><span class="c4"></span></p>
         <p class="c0"><span class="c12">Before start testing our endpoint, let’s create a very basic version of these two static pages. </span><span class="c12">Under the “</span><span class="c8">public</span><span class="c12">” folder, create </span><span class="c8">password.html</span><span class="c12">&nbsp;and </span><span class="c8">account.html</span><span class="c12">:</span></p>
         <p class="c17 c11"><span class="c4"></span></p>
         <a id="t.dad0099888ba03a7ffa20b78dcc5df670e0818d2"></a><a id="t.24"></a>
         <table class="c16">
            <tbody>
               <tr class="c13">
                  <td class="c24" colspan="1" rowspan="1">
                     <p class="c17"><span class="c5">&lt;html&gt;</span><span class="c6"><br> &nbsp; &nbsp;</span><span class="c5">&lt;body&gt;</span><span class="c6"><br> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c5">Hello</span><span class="c6">&nbsp;there! I am the password page<br> &nbsp; &nbsp;</span><span class="c5">&lt;/body&gt;</span><span class="c6"><br></span><span class="c5">&lt;/html&gt;</span></p>
                  </td>
               </tr>
            </tbody>
         </table>
         <p class="c17 c11"><span class="c4"></span></p>
         <p class="c17 c11"><span class="c4"></span></p>
         <a id="t.0d9712e2bd2ae806b40120d2e1e0ee3d02514f16"></a><a id="t.25"></a>
         <table class="c16">
            <tbody>
               <tr class="c13">
                  <td class="c24" colspan="1" rowspan="1">
                     <p class="c17"><span class="c5">&lt;html&gt;</span><span class="c6"><br> &nbsp; &nbsp;</span><span class="c5">&lt;body&gt;</span><span class="c6"><br> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c5">Hello</span><span class="c6">&nbsp;there! I am the account page<br> &nbsp; &nbsp;</span><span class="c5">&lt;/body&gt;</span><span class="c6"><br></span><span class="c5">&lt;/html&gt;</span></p>
                  </td>
               </tr>
            </tbody>
         </table>
         <p class="c17 c11"><span class="c4"></span></p>
         <p class="c17 c11"><span class="c4"></span></p>
         <p class="c0"><span class="c12">We can now test the flow. </span><span class="c12">Restart, the server </span><span class="c4">and complete a new purchase. Because we haven’t set passwords for any user yet you should end up in the password page.</span></p>
         <p class="c0 c11"><span class="c4"></span></p>
         <p class="c0"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 272.00px; height: 67.00px;"><img alt="" src="./Account creation post purchase_files/Screenshot 2019-04-02 at 15.02.21.png" style="width: 272.00px; height: 67.00px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p>
         <p class="c0 c11"><span class="c4"></span></p>
         <p class="c0"><span class="c12">A</span><span class="c12">s a last step, we w</span><span class="c4">ill add some logic to this password page to send the password to our backend and complete the registration process. At the very minimum, it should contain an input to set the password and a function to submit the data.</span></p>
         <p class="c0 c11"><span class="c4"></span></p>
         <p class="c0 c11"><span class="c4"></span></p>
         <a id="t.402487467a918a0dc3099bec914027f1f98bef8d"></a><a id="t.26"></a>
         <table class="c16">
            <tbody>
               <tr class="c13">
                  <td class="c24" colspan="1" rowspan="1">
                     <p class="c17"><span class="c10">&lt;</span><span class="c9">html</span><span class="c10">&nbsp;lang=</span><span class="c14">"en"</span><span class="c10">&gt;</span><span class="c6"><br> &nbsp; &nbsp;</span><span class="c10">&lt;</span><span class="c9">body</span><span class="c10">&gt;</span><span class="c6"><br> &nbsp; &nbsp; &nbsp; </span><span class="c10">&lt;</span><span class="c9">input</span><span class="c10">&nbsp;type=</span><span class="c14">"password"</span><span class="c10">&nbsp;id=</span><span class="c14">"inputPassword"</span><span class="c10">&nbsp;placeholder=</span><span class="c14">"Password"</span><span class="c10">&nbsp;required=</span><span class="c14">""</span><span class="c10">&gt;</span><span class="c6"><br><br> &nbsp; &nbsp; &nbsp; </span><span class="c10">&lt;</span><span class="c9">button</span><span class="c10">&nbsp;onclick=</span><span class="c14">"submitPassword()"</span><span class="c10">&gt;</span><span class="c6">Sign in</span><span class="c10">&lt;/</span><span class="c9">button</span><span class="c10">&gt;</span><span class="c6"><br><br> &nbsp; &nbsp; &nbsp; </span><span class="c10">&lt;</span><span class="c9">script</span><span class="c10">&nbsp;type=</span><span class="c14">"text/javascript"</span><span class="c29 c10">&gt;</span></p>
                     <p class="c17"><span class="c6"><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c7">function</span><span class="c6">&nbsp;</span><span class="c5">submitPassword</span><span class="c6">() {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c18">// Check that user comes from purchasing an item by checking</span><span class="c6"><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c18">// the accountId set by the server</span><span class="c6"><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c7">const</span><span class="c6">&nbsp;urlParams = </span><span class="c7">new</span><span class="c6">&nbsp;URLSearchParams(</span><span class="c5">window</span><span class="c6">.location.search);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c7">if</span><span class="c6">&nbsp;(urlParams.has(</span><span class="c14">'accountId'</span><span class="c6">)) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c7">const</span><span class="c6">&nbsp;accountId = urlParams.get(</span><span class="c14">'accountId'</span><span class="c6">);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c7">const</span><span class="c6">&nbsp;password = </span><span class="c5">document</span><span class="c6">.getElementById(</span><span class="c14">'inputPassword'</span><span class="c6">).value;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c18">// Create AJAX request to our backend</span><span class="c6"><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c7">const</span><span class="c6">&nbsp;Http = </span><span class="c7">new</span><span class="c6">&nbsp;XMLHttpRequest();<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c7">const</span><span class="c6">&nbsp;url= </span><span class="c14">'setPassword'</span><span class="c6">;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Http.open(</span><span class="c14">'POST'</span><span class="c6">, url, </span><span class="c7">true</span><span class="c6">);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Http.setRequestHeader(</span><span class="c14">"Content-Type"</span><span class="c6">, </span><span class="c14">"application/json"</span><span class="c6">);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Http.onreadystatechange = </span><span class="c7">function</span><span class="c6">(){<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c7">if</span><span class="c6">&nbsp;(</span><span class="c7">this</span><span class="c6">.readyState === </span><span class="c31">4</span><span class="c6">&nbsp;&amp;&amp; </span><span class="c7">this</span><span class="c6">.status === </span><span class="c31">200</span><span class="c6">) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c7">const</span><span class="c6">&nbsp;res = </span><span class="c5">JSON</span><span class="c6">.parse(</span><span class="c7">this</span><span class="c6">.responseText);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c7">if</span><span class="c6">&nbsp;(res &amp;&amp; res.success) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c5">window</span><span class="c6">.location.href = res.redirect;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;} </span><span class="c7">else</span><span class="c6">&nbsp;{<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;alert(</span><span class="c14">`Error setting password: ${res.error}`</span><span class="c6">);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;};<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Http.send(</span><span class="c5">JSON</span><span class="c6">.stringify({<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;accountId,<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;password<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}));<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c10">&lt;/</span><span class="c9">script</span><span class="c10">&gt;</span><span class="c6"><br> &nbsp; &nbsp;</span><span class="c10">&lt;/</span><span class="c9">body</span><span class="c10">&gt;</span><span class="c6"><br></span><span class="c10">&lt;/</span><span class="c9">html</span><span class="c10">&gt;</span></p>
                  </td>
               </tr>
            </tbody>
         </table>
         <p class="c0 c11"><span class="c4"></span></p>
         <p class="c0"><span class="c4">We will send the password set by the user along with the accountId again back to our backend. If everything was successful, we will redirect the user to their account page.</span></p>
         <p class="c0 c11"><span class="c4"></span></p>
         <p class="c0"><span class="c4">We will proceed to create our last endpoint, called ‘setPassword’. It will receive the accountId and password previously set by the user and add it to the account.</span></p>
         <p class="c0 c11"><span class="c4"></span></p>
         <p class="c0 c11"><span class="c4"></span></p>
         <a id="t.1951b324b321a8221d0bd3f8279b1bdac7fbf77a"></a><a id="t.27"></a>
         <table class="c16">
            <tbody>
               <tr class="c13">
                  <td class="c24" colspan="1" rowspan="1">
                     <p class="c17"><span class="c18">/* POST /setPassword<br> * Set password to a buyer based on the given accountId<br> *<br> * @param {String} - accountId<br> * @param {String} - password<br> * @returns {Object} - Redirect user to account page<br> */</span><span class="c6"><br>app.post(</span><span class="c14">'/setPassword'</span><span class="c6">, (req, res) =&gt; {<br> &nbsp; &nbsp;</span><span class="c7">try</span><span class="c6">&nbsp;{<br> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c18">// Make sure accountId and password are in the request</span><span class="c6"><br> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c7">if</span><span class="c6">&nbsp;(!(req.body &amp;&amp; req.body.accountId &amp;&amp; req.body.password)) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c7">throw</span><span class="c6">&nbsp;</span><span class="c7">new</span><span class="c6">&nbsp;</span><span class="c5">Error</span><span class="c6">(</span><span class="c14">'Email or password params not found in request'</span><span class="c6">);<br> &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c18">// Check that the accountId exists in database</span><span class="c6"><br> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c7">const</span><span class="c6">&nbsp;{ accountId, password } = req.body;<br> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c7">const</span><span class="c6">&nbsp;dbContent = DBdriver.getContent();<br> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c7">if</span><span class="c6">&nbsp;(!dbContent[accountId]) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c7">throw</span><span class="c6">&nbsp;</span><span class="c7">new</span><span class="c6">&nbsp;</span><span class="c5">Error</span><span class="c6">(</span><span class="c14">'User not found'</span><span class="c6">);<br> &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c18">// Save password in database</span><span class="c6"><br> &nbsp; &nbsp; &nbsp; &nbsp;dbContent[accountId].password = password;<br> &nbsp; &nbsp; &nbsp; &nbsp;DBdriver.writeContent(dbContent);<br><br> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c18">// Redirect to account page</span><span class="c6"><br> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c7">return</span><span class="c6">&nbsp;res.json({ success: </span><span class="c7">true</span><span class="c6">, redirect: </span><span class="c14">`/account.html?accountId=${accountId}`</span><span class="c6">&nbsp;});<br> &nbsp; &nbsp;} </span><span class="c7">catch</span><span class="c6">&nbsp;(err) {<br> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c5">console</span><span class="c6">.log(</span><span class="c14">'An error has occurred setting the password: '</span><span class="c6">, err.message);<br> &nbsp; &nbsp; &nbsp; &nbsp;res.json({ success: </span><span class="c7">false</span><span class="c6">, error: err.message });<br> &nbsp; &nbsp;}<br>});</span></p>
                  </td>
               </tr>
            </tbody>
         </table>
         <p class="c0 c11"><span class="c4"></span></p>
         <p class="c0"><span class="c4">To finish off, we have to add some logic to our accounts page so that it displays the account information for those buyers who are fully registered (this is, they have completed a purchase and have input the password). For those who are not registered yet, it should redirect them to the store or password page accordingly.</span></p>
         <p class="c0 c11"><span class="c4"></span></p>
         <p class="c0"><span class="c12">Let’s add the following script to our </span><span class="c8">account.html</span><span class="c4">:</span></p>
         <p class="c0 c11"><span class="c4"></span></p>
         <a id="t.98ba15b77d1eb37f125af0c78e1ee907e8dd40c8"></a><a id="t.28"></a>
         <table class="c16">
            <tbody>
               <tr class="c13">
                  <td class="c24" colspan="1" rowspan="1">
                     <p class="c17"><span class="c10">&lt;</span><span class="c9">script</span><span class="c10">&gt;</span><span class="c6"><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c5">window</span><span class="c6">.addEventListener(</span><span class="c14">'DOMContentLoaded'</span><span class="c6">, (event) =&gt; {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c18">// Check if user is registered based on the GET params</span><span class="c6"><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c7">const</span><span class="c6">&nbsp;urlParams = </span><span class="c7">new</span><span class="c6">&nbsp;URLSearchParams(</span><span class="c5">window</span><span class="c6">.location.search);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c7">if</span><span class="c6">&nbsp;(urlParams.has(</span><span class="c14">'accountId'</span><span class="c6">)) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c7">const</span><span class="c6">&nbsp;accountId = urlParams.get(</span><span class="c14">'accountId'</span><span class="c6">);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c18">// Create AJAX request to our backend</span><span class="c6"><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c7">const</span><span class="c6">&nbsp;Http = </span><span class="c7">new</span><span class="c6">&nbsp;XMLHttpRequest();<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c7">const</span><span class="c6">&nbsp;url= </span><span class="c14">'getAccount'</span><span class="c6">;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Http.open(</span><span class="c14">'POST'</span><span class="c6">, url, </span><span class="c7">true</span><span class="c6">);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Http.setRequestHeader(</span><span class="c14">"Content-Type"</span><span class="c6">, </span><span class="c14">"application/json"</span><span class="c6">);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Http.onreadystatechange = </span><span class="c7">function</span><span class="c6">(){<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c7">if</span><span class="c6">&nbsp;(</span><span class="c7">this</span><span class="c6">.readyState === </span><span class="c31">4</span><span class="c6">&nbsp;&amp;&amp; </span><span class="c7">this</span><span class="c6">.status === </span><span class="c31">200</span><span class="c6">) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c7">const</span><span class="c6">&nbsp;res = </span><span class="c5">JSON</span><span class="c6">.parse(</span><span class="c7">this</span><span class="c6">.responseText);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c7">if</span><span class="c6">&nbsp;(res &amp;&amp; res.success) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c5">document</span><span class="c6">.getElementById(</span><span class="c14">'accountHeader'</span><span class="c6">).innerHTML = </span><span class="c14">'Your account details'</span><span class="c6">;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c5">document</span><span class="c6">.getElementById(</span><span class="c14">'detailsDiv'</span><span class="c6">).style.display = </span><span class="c14">'block'</span><span class="c6">;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c5">document</span><span class="c6">.getElementById(</span><span class="c14">'accountMessage'</span><span class="c6">).innerHTML = </span><span class="c5">JSON</span><span class="c6">.stringify(res.account, </span><span class="c7">null</span><span class="c6">, </span><span class="c31">2</span><span class="c6">);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;} </span><span class="c7">else</span><span class="c6">&nbsp;</span><span class="c7">if</span><span class="c6">&nbsp;(res.error &amp;&amp; res.redirect){<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;alert(</span><span class="c14">`Error in account: ${res.error}`</span><span class="c6">);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c5">window</span><span class="c6">.location.href = res.redirect;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;} </span><span class="c7">else</span><span class="c6">&nbsp;{<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c5">window</span><span class="c6">.location.href = </span><span class="c14">'store.html'</span><span class="c6">;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;};<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Http.send(</span><span class="c5">JSON</span><span class="c6">.stringify({<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;accountId<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}));<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;} </span><span class="c7">else</span><span class="c6">&nbsp;{<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c5">window</span><span class="c6">.location.href = </span><span class="c14">'store.html'</span><span class="c6">;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;});<br> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c10">&lt;/</span><span class="c9">script</span><span class="c10">&gt;</span></p>
                  </td>
               </tr>
            </tbody>
         </table>
         <p class="c0 c11"><span class="c4"></span></p>
         <p class="c0 c11"><span class="c4"></span></p>
         <p class="c0"><span class="c4">It basically expects the accountId to be provided in the url and sends it back to our backend to check whether the account is fully registered. If so, it will overwrite the content of certain empty elements of our page with that account information.</span></p>
         <p class="c0 c11"><span class="c4"></span></p>
         <p class="c0"><span class="c4">In the backend we add the last endpoint to actually retrieve that information:</span></p>
         <p class="c0 c11"><span class="c4"></span></p>
         <a id="t.d17a5e07f3f5b57003499663d3dc1154c3a6c03b"></a><a id="t.29"></a>
         <table class="c16">
            <tbody>
               <tr class="c13">
                  <td class="c24" colspan="1" rowspan="1">
                     <p class="c17"><span class="c18">/* POST /getAccount<br> * Get account details if user is already registered. Otherwise, redirect them to <br> * previous pages to complete their account.<br> *<br> * @param {String} - accountId<br> * @returns {Object} - account information<br> */</span><span class="c6"><br>app.post(</span><span class="c14">'/getAccount'</span><span class="c6">, (req, res) =&gt; {<br> &nbsp; &nbsp;</span><span class="c7">try</span><span class="c6">&nbsp;{<br> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c18">// Make sure accountId is in the request</span><span class="c6"><br> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c7">if</span><span class="c6">&nbsp;(!(req.body &amp;&amp; req.body.accountId)) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c7">return</span><span class="c6">&nbsp;res.</span><span class="c5">json</span><span class="c6">({<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;success: </span><span class="c7">false</span><span class="c6">,<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c7">error</span><span class="c6">: </span><span class="c14">'User not found. Please create one by purchasing a new item'</span><span class="c6">,<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;redirect: </span><span class="c14">'/store.html'</span><span class="c6"><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;});<br> &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c18">// Check that the accountId exists in database</span><span class="c6"><br> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c7">const</span><span class="c6">&nbsp;{ accountId } = req.body;<br> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c7">const</span><span class="c6">&nbsp;dbContent = DBdriver.getContent();<br> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c7">if</span><span class="c6">&nbsp;(!dbContent[accountId]) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c7">return</span><span class="c6">&nbsp;res.</span><span class="c5">json</span><span class="c6">({<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;success: </span><span class="c7">false</span><span class="c6">,<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c7">error</span><span class="c6">: </span><span class="c14">'User not found. Please create one by purchasing a new item'</span><span class="c6">,<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;redirect: </span><span class="c14">'/store.html'</span><span class="c6"><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;});<br> &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c7">const</span><span class="c6">&nbsp;account = dbContent[accountId];<br> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c18">// User exists, check if it has set its password</span><span class="c6"><br> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c7">if</span><span class="c6">&nbsp;(!account.password) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c18">// User hasn't provided password yet, redirect to password page</span><span class="c6"><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c7">return</span><span class="c6">&nbsp;res.</span><span class="c5">json</span><span class="c6">({<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;success: </span><span class="c7">false</span><span class="c6">,<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c7">error</span><span class="c6">: </span><span class="c14">'Please complete your account providing a password'</span><span class="c6">,<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;redirect: `/password.html?accountId=${accountId}`<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;});<br> &nbsp; &nbsp; &nbsp; &nbsp;}<br><br> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c18">// Offer account information to users</span><span class="c6"><br> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c7">return</span><span class="c6">&nbsp;res.</span><span class="c5">json</span><span class="c6">({ success: </span><span class="c7">true</span><span class="c6">, account });<br> &nbsp; &nbsp;} </span><span class="c7">catch</span><span class="c6">&nbsp;(err) {<br> &nbsp; &nbsp; &nbsp; &nbsp;res.json({ success: </span><span class="c7">false</span><span class="c6">, </span><span class="c7">error</span><span class="c6">: err.message });<br> &nbsp; &nbsp;}<br>});</span></p>
                  </td>
               </tr>
            </tbody>
         </table>
         <p class="c0 c11"><span class="c4"></span></p>
         <p class="c0"><span class="c4">You can now restart the server and test the whole flow!</span></p>
         <p class="c0 c11"><span class="c4"></span></p>
         <p class="c0 c11"><span class="c4"></span></p>
         <h1 class="c0 c1" id="h.h0way9wbjhi5"><span class="c26 c38">Wrapping up</span></h1>
         <p class="c0 c11"><span class="c3"></span></p>
         <p class="c0"><span class="c3">Congratulations! You have just developed an application that creates an account in your backend after the user completes a purchase with FastSpring. We have covered how to:</span></p>
         <ul class="c34 lst-kix_p3pkczoti3si-0 start">
            <li class="c0 c19"><span>Add an item to the cart session and launch the popup cart using the </span><span class="c41"><a class="c32" href="https://www.google.com/url?q=https://www.fastspringexamples.com/Actions/chainedaction&amp;sa=D&amp;ust=1572620697711000">data-fsc-action</a></span><span class="c3">&nbsp;of the Store Builder Library.</span></li>
            <li class="c0 c19"><span>Subscribe to the </span><span class="c41"><a class="c32" href="https://www.google.com/url?q=https://docs.fastspring.com/integrating-with-fastspring/webhooks/order-completed&amp;sa=D&amp;ust=1572620697712000">order.completed</a></span><span>&nbsp;webhook and parse the JSON object that is returned.</span></li>
            <li class="c0 c19"><span>Use the </span><span class="c41"><a class="c32" href="https://www.google.com/url?q=https://docs.fastspring.com/integrating-with-fastspring/store-builder-library/getting-started-with-store-builder-library&amp;sa=D&amp;ust=1572620697712000">data-popup-close</a></span><span>&nbsp;callback function to redirect the user when the popup is closed and retrieve the orderID for the order that was just executed from the JSON</span><span>.</span></li>
            <li class="c0 c19"><span>Retrieve the details of an existing</span><span>&nbsp;</span><span>order with the </span><span class="c41"><a class="c32" href="https://www.google.com/url?q=https://docs.fastspring.com/integrating-with-fastspring/fastspring-api/orders&amp;sa=D&amp;ust=1572620697713000">/orders API</a></span><span class="c3">&nbsp;endpoint.</span></li>
         </ul>
         <p class="c0 c11"><span class="c3"></span></p>
         <p class="c0"><span>To learn more about how to integrate other common eCommerce scenarios with FastSpring </span><span>check out our </span><span class="c41"><a class="c32" href="https://www.google.com/url?q=https://www.fastspringexamples.com/&amp;sa=D&amp;ust=1572620697713000">tutorials</a></span><span>&nbsp;page! </span></p>
         <div>
            <p class="c51"><span>&nbsp;| </span><span class="c29 c47">Page</span></p>
            <p class="c0"><span class="c3">FastSpring PSI Tutorial &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp; </span></p>
         </div>
      </div>
      <div id="footer"><span>Published by <a target="_blank" title="Learn more about Google Drive" href="https://docs.google.com/">Google Drive</a></span><span class="dash">–</span><a href="https://docs.google.com/a/fastspring.com/abuse?id=AKkXjowIYICAE133DfyjjUDPrdRBhc6IXagkkELY9PBIC1lqPgrXbuEV6-bMP68u-LVh4F9HymSBz9LsVJpq3Sk:0">Report Abuse</a><span class="dash">–</span><span>Updated automatically every 5 minutes</span></div>
      <script type="text/javascript" nonce="">(function(){var aa="function"==typeof Object.create?Object.create:function(a){function b(){}b.prototype=a;return new b},ba;if("function"==typeof Object.setPrototypeOf)ba=Object.setPrototypeOf;else{var ca;a:{var da={u:!0},ea={};try{ea.__proto__=da;ca=ea.u;break a}catch(a){}ca=!1}ba=ca?function(a,b){a.__proto__=b;if(a.__proto__!==b)throw new TypeError(a+" is not extensible");return a}:null}var fa=ba;
         function k(a,b){a.prototype=aa(b.prototype);a.prototype.constructor=a;if(fa)fa(a,b);else for(var c in b)if("prototype"!=c)if(Object.defineProperties){var d=Object.getOwnPropertyDescriptor(b,c);d&&Object.defineProperty(a,c,d)}else a[c]=b[c];a.l=b.prototype}var l=this||self;function ha(){}
         function m(a){var b=typeof a;if("object"==b)if(a){if(a instanceof Array)return"array";if(a instanceof Object)return b;var c=Object.prototype.toString.call(a);if("[object Window]"==c)return"object";if("[object Array]"==c||"number"==typeof a.length&&"undefined"!=typeof a.splice&&"undefined"!=typeof a.propertyIsEnumerable&&!a.propertyIsEnumerable("splice"))return"array";if("[object Function]"==c||"undefined"!=typeof a.call&&"undefined"!=typeof a.propertyIsEnumerable&&!a.propertyIsEnumerable("call"))return"function"}else return"null";
         else if("function"==b&&"undefined"==typeof a.call)return"object";return b}function ia(a){var b=typeof a;return"object"==b&&null!=a||"function"==b}function ja(a,b){var c=Array.prototype.slice.call(arguments,1);return function(){var d=c.slice();d.push.apply(d,arguments);return a.apply(this,d)}}function ka(a,b){function c(){}c.prototype=b.prototype;a.l=b.prototype;a.prototype=new c;a.prototype.constructor=a};function la(a){la[" "](a);return a}la[" "]=ha;function p(a,b,c){return Object.prototype.hasOwnProperty.call(a,b)?a[b]:a[b]=c(b)};function ma(a){return p(a.prototype,"$$generatedClassName",function(){return"Class$obf_"+{valueOf:function(){return++na}}})}var na=1E3;function q(){}q.prototype.v=function(){return oa(this)};q.prototype.toString=function(){return t(u(v(this.constructor)))+"@"+t((this.v()>>>0).toString(16))};function w(){this.b=!1}k(w,q);w.prototype.f=function(a){this.a=a;if(null!=a)try{a.s=this}catch(b){}this.j&&this.a instanceof Error&&(this.a.cause=this.j.a)};function pa(a){a.b&&a.a instanceof Error&&(Error.captureStackTrace?Error.captureStackTrace(a.a):a.a.stack=Error().stack)}w.prototype.toString=function(){var a=u(v(this.constructor)),b=this.g;return null==b?a:t(a)+": "+t(b)};function qa(){this.b=!1}k(qa,w);function ra(){this.b=!1}k(ra,qa);function sa(a,b){this.b=a;this.a=b}k(sa,q);function u(a){var b=ma(a.b);0!=a.a&&(b="L"+t(b)+";");a=a.a;for(var c="",d=0;d<a;d++)c=t(c)+"[";return t(c)+t(b)}sa.prototype.toString=function(){return"class "+t(u(this))};function v(a,b){var c=b||0;return p(a.prototype,"$$class/"+c,function(){return new sa(a,c)})};function oa(a){return a.m||(Object.defineProperties(a,{m:{value:++ta,enumerable:!1}}),a.m)}var ta=0;function x(){this.b=!1}k(x,ra);x.prototype.f=function(a){ra.prototype.f.call(this,"__noinit__"===this.c?a:this.c)};function ua(){this.b=!1}k(ua,x);function va(a,b){return"string"==typeof a?a.charCodeAt(b):a.C(b)};function t(a){if(null==a)a="null";else if(a instanceof Array){var b=a.w;a=u(b?v(b.B,b.A):v(q,1))+"@"+(oa(a)>>>0).toString(16)}else a=a.toString();return a}function wa(a){if(65536<=a){var b=56320+(a-65536&1023)&65535;return t(String.fromCharCode(55296+(a-65536>>10&1023)&65535))+t(String.fromCharCode(b))}return String.fromCharCode(a&65535)}
         function xa(a,b){var c=b,d=a.length;b=va(a,c++);var e;if(d=55296<=b&&56319>=b&&c<d)a=e=va(a,c),d=56320<=a&&57343>=a;var f;d?f=65536+((b&1023)<<10)+(e&1023):f=b;return f};function ya(a,b){return null==a?a:b?decodeURI(a):decodeURIComponent(a)};var za=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^/?#]*)@)?([^/#?]*?)(?::([0-9]+))?(?=[/#?]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\S\s]*))?$/;function Aa(a){a=za.exec(a);for(var b=[],c=0;7>=c;c++)a.length<=c||null==a[c]?b.push(null):b.push(a[c]);return b}
         function Ba(a,b){var c=wa(35);c=a.indexOf(c);c=0>c?a.length:c;a:{var d=0;for(var e=b.length;0<(d=a.indexOf(b,d))&&d<c;){var f=xa(a,d-1);if(38==f||63==f){if(d+e>=a.length)break a;f=xa(a,d+e);if(61==f||38==f||35==f)break a}d+=e+1}d=-1}if(0>d)return null;e=d;f=wa(38);e=a.indexOf(f,e);if(0>e||e>c)e=c;d+=b.length+1;b=Math.min(a.length,d);a=a.substr(b,Math.min(a.length,Math.max(d,e))-b);c=" ";for(b=0;0<=(b=c.indexOf("\\",b));)36==c.charCodeAt(b+1)?(d=t(c.substr(0,b))+"$",e=++b,c=d+t(c.substr(e))):(d=t(c.substr(0,
         b)),e=++b,c=d+t(c.substr(e)));a=a.replace(/\+/g,c);return ya(a,!1)};var Da=Array.prototype.indexOf?function(a,b){return Array.prototype.indexOf.call(a,b,void 0)}:function(a,b){if("string"===typeof a)return"string"!==typeof b||1!=b.length?-1:a.indexOf(b,0);for(var c=0;c<a.length;c++)if(c in a&&a[c]===b)return c;return-1};function Ea(a,b,c){for(var d in a)b.call(c,a[d],d,a)};var Fa=String.prototype.trim?function(a){return a.trim()}:function(a){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(a)[1]},Ga=/&/g,Ha=/</g,Ia=/>/g,Ja=/"/g,Ka=/'/g,La=/\x00/g,Ma=/[\x00&<>"']/;function Na(a,b){return a<b?-1:a>b?1:0};function y(a,b){this.c=a===Oa&&b||"";this.f=Pa}y.prototype.b=!0;y.prototype.a=function(){return this.c.toString()};function Qa(a){if(a instanceof y&&a.constructor===y&&a.f===Pa)return a.c;m(a);return"type_error:SafeUrl"}var Ra=/^(?:(?:https?|mailto|ftp):|[^:/?#]*(?:[/?#]|$))/i,Pa={},Oa={};var z;a:{var Sa=l.navigator;if(Sa){var Ta=Sa.userAgent;if(Ta){z=Ta;break a}}z=""}function A(a){return-1!=z.indexOf(a)};function B(){this.c="";this.f=Ua}B.prototype.b=!0;B.prototype.a=function(){return this.c.toString()};function Va(a){if(a instanceof B&&a.constructor===B&&a.f===Ua)return a.c;m(a);return"type_error:SafeHtml"}var Ua={};function D(a,b){this.b=b;for(var c=[],d=!0,e=a.length-1;0<=e;e--){var f=a[e]|0;d&&f==b||(c[e]=f,d=!1)}this.a=c}var Wa={};function Xa(a){return-128<=a&&128>a?p(Wa,a,function(b){return new D([b|0],0>b?-1:0)}):new D([a|0],0>a?-1:0)}function E(a){if(isNaN(a)||!isFinite(a))return F;if(0>a)return G(E(-a));for(var b=[],c=1,d=0;a>=c;d++)b[d]=a/c|0,c*=4294967296;return new D(b,0)}var F=Xa(0),H=Xa(1),Ya=Xa(16777216);
         function I(a){if(-1==a.b)return-I(G(a));for(var b=0,c=1,d=0;d<a.a.length;d++){var e=J(a,d);b+=(0<=e?e:4294967296+e)*c;c*=4294967296}return b}D.prototype.toString=function(a){a=a||10;if(2>a||36<a)throw Error("radix out of range: "+a);if(K(this))return"0";if(-1==this.b)return"-"+G(this).toString(a);for(var b=E(Math.pow(a,6)),c=this,d="";;){var e=Za(c,b).a;c=L(c,M(e,b));var f=((0<c.a.length?c.a[0]:c.b)>>>0).toString(a);c=e;if(K(c))return f+d;for(;6>f.length;)f="0"+f;d=f+d}};
         function J(a,b){return 0>b?0:b<a.a.length?a.a[b]:a.b}function K(a){if(0!=a.b)return!1;for(var b=0;b<a.a.length;b++)if(0!=a.a[b])return!1;return!0}function N(a,b){a=L(a,b);return-1==a.b?-1:K(a)?0:1}function G(a){for(var b=a.a.length,c=[],d=0;d<b;d++)c[d]=~a.a[d];return(new D(c,~a.b)).add(H)}D.prototype.abs=function(){return-1==this.b?G(this):this};
         D.prototype.add=function(a){for(var b=Math.max(this.a.length,a.a.length),c=[],d=0,e=0;e<=b;e++){var f=d+(J(this,e)&65535)+(J(a,e)&65535),g=(f>>>16)+(J(this,e)>>>16)+(J(a,e)>>>16);d=g>>>16;f&=65535;g&=65535;c[e]=g<<16|f}return new D(c,c[c.length-1]&-2147483648?-1:0)};function L(a,b){return a.add(G(b))}
         function M(a,b){if(K(a)||K(b))return F;if(-1==a.b)return-1==b.b?M(G(a),G(b)):G(M(G(a),b));if(-1==b.b)return G(M(a,G(b)));if(0>N(a,Ya)&&0>N(b,Ya))return E(I(a)*I(b));for(var c=a.a.length+b.a.length,d=[],e=0;e<2*c;e++)d[e]=0;for(e=0;e<a.a.length;e++)for(var f=0;f<b.a.length;f++){var g=J(a,e)>>>16,h=J(a,e)&65535,r=J(b,f)>>>16,n=J(b,f)&65535;d[2*e+2*f]+=h*n;O(d,2*e+2*f);d[2*e+2*f+1]+=g*n;O(d,2*e+2*f+1);d[2*e+2*f+1]+=h*r;O(d,2*e+2*f+1);d[2*e+2*f+2]+=g*r;O(d,2*e+2*f+2)}for(e=0;e<c;e++)d[e]=d[2*e+1]<<16|
         d[2*e];for(e=c;e<2*c;e++)d[e]=0;return new D(d,0)}function O(a,b){for(;(a[b]&65535)!=a[b];)a[b+1]+=a[b]>>>16,a[b]&=65535,b++}function P(a,b){this.a=a;this.b=b}
         function Za(a,b){if(K(b))throw Error("division by zero");if(K(a))return new P(F,F);if(-1==a.b)return b=Za(G(a),b),new P(G(b.a),G(b.b));if(-1==b.b)return b=Za(a,G(b)),new P(G(b.a),b.b);if(30<a.a.length){if(-1==a.b||-1==b.b)throw Error("slowDivide_ only works with positive integers.");for(var c=H,d=b;0>=N(d,a);)c=Q(c,1),d=Q(d,1);var e=S(c,1),f=S(d,1);d=S(d,2);for(c=S(c,2);!K(d);){var g=f.add(d);0>=N(g,a)&&(e=e.add(c),f=g);d=S(d,1);c=S(c,1)}b=L(a,M(e,b));return new P(e,b)}for(e=F;0<=N(a,b);){c=Math.max(1,
         Math.floor(I(a)/I(b)));d=Math.ceil(Math.log(c)/Math.LN2);d=48>=d?1:Math.pow(2,d-48);f=E(c);for(g=M(f,b);-1==g.b||0<N(g,a);)c-=d,f=E(c),g=M(f,b);K(f)&&(f=H);e=e.add(f);a=L(a,g)}return new P(e,a)}D.prototype.and=function(a){for(var b=Math.max(this.a.length,a.a.length),c=[],d=0;d<b;d++)c[d]=J(this,d)&J(a,d);return new D(c,this.b&a.b)};D.prototype.or=function(a){for(var b=Math.max(this.a.length,a.a.length),c=[],d=0;d<b;d++)c[d]=J(this,d)|J(a,d);return new D(c,this.b|a.b)};
         D.prototype.xor=function(a){for(var b=Math.max(this.a.length,a.a.length),c=[],d=0;d<b;d++)c[d]=J(this,d)^J(a,d);return new D(c,this.b^a.b)};function Q(a,b){var c=b>>5;b%=32;for(var d=a.a.length+c+(0<b?1:0),e=[],f=0;f<d;f++)e[f]=0<b?J(a,f-c)<<b|J(a,f-c-1)>>>32-b:J(a,f-c);return new D(e,a.b)}function S(a,b){var c=b>>5;b%=32;for(var d=a.a.length-c,e=[],f=0;f<d;f++)e[f]=0<b?J(a,f+c)>>>b|J(a,f+c+1)<<32-b:J(a,f+c);return new D(e,a.b)};L(Q(H,32),H);L(Q(H,128),H);var $a=A("Opera"),T=A("Trident")||A("MSIE"),ab=A("Edge"),bb=ab||T,cb=A("Gecko")&&!(-1!=z.toLowerCase().indexOf("webkit")&&!A("Edge"))&&!(A("Trident")||A("MSIE"))&&!A("Edge"),db=-1!=z.toLowerCase().indexOf("webkit")&&!A("Edge"),eb=A("Macintosh");function fb(){var a=l.document;return a?a.documentMode:void 0}var gb;
         a:{var hb="",ib=function(){var a=z;if(cb)return/rv:([^\);]+)(\)|;)/.exec(a);if(ab)return/Edge\/([\d\.]+)/.exec(a);if(T)return/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(a);if(db)return/WebKit\/(\S+)/.exec(a);if($a)return/(?:Version)[ \/]?(\S+)/.exec(a)}();ib&&(hb=ib?ib[1]:"");if(T){var jb=fb();if(null!=jb&&jb>parseFloat(hb)){gb=String(jb);break a}}gb=hb}var kb=gb,lb={},mb;mb=l.document&&T?fb():void 0;function U(){this.b=this.b;this.a=this.a}U.prototype.b=!1;U.prototype.o=function(){this.b||(this.b=!0,this.f())};U.prototype.f=function(){if(this.a)for(;this.a.length;)this.a.shift()()};function nb(a){a&&"function"==typeof a.o&&a.o()};var ob=!T||9<=Number(mb),pb=!T||9<=Number(mb),qb=T&&!p(lb,"9",function(){for(var a=0,b=Fa(String(kb)).split("."),c=Fa("9").split("."),d=Math.max(b.length,c.length),e=0;0==a&&e<d;e++){var f=b[e]||"",g=c[e]||"";do{f=/(\d*)(\D*)(.*)/.exec(f)||["","","",""];g=/(\d*)(\D*)(.*)/.exec(g)||["","","",""];if(0==f[0].length&&0==g[0].length)break;a=Na(0==f[1].length?0:parseInt(f[1],10),0==g[1].length?0:parseInt(g[1],10))||Na(0==f[2].length,0==g[2].length)||Na(f[2],g[2]);f=f[3];g=g[3]}while(0==a)}return 0<=a}),
         rb=function(){if(!l.addEventListener||!Object.defineProperty)return!1;var a=!1,b=Object.defineProperty({},"passive",{get:function(){a=!0}});try{l.addEventListener("test",ha,b),l.removeEventListener("test",ha,b)}catch(c){}return a}();function sb(a,b){this.type=a;this.a=this.target=b;this.f=!1}sb.prototype.c=function(){this.f=!0};function V(a,b){sb.call(this,a?a.type:"");this.relatedTarget=this.a=this.target=null;this.button=this.screenY=this.screenX=this.clientY=this.clientX=0;this.key="";this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1;this.pointerId=0;this.pointerType="";this.b=null;if(a){var c=this.type=a.type,d=a.changedTouches&&a.changedTouches.length?a.changedTouches[0]:null;this.target=a.target||a.srcElement;this.a=b;if(b=a.relatedTarget){if(cb){a:{try{la(b.nodeName);var e=!0;break a}catch(f){}e=!1}e||(b=null)}}else"mouseover"==
         c?b=a.fromElement:"mouseout"==c&&(b=a.toElement);this.relatedTarget=b;d?(this.clientX=void 0!==d.clientX?d.clientX:d.pageX,this.clientY=void 0!==d.clientY?d.clientY:d.pageY,this.screenX=d.screenX||0,this.screenY=d.screenY||0):(this.clientX=void 0!==a.clientX?a.clientX:a.pageX,this.clientY=void 0!==a.clientY?a.clientY:a.pageY,this.screenX=a.screenX||0,this.screenY=a.screenY||0);this.button=a.button;this.key=a.key||"";this.ctrlKey=a.ctrlKey;this.altKey=a.altKey;this.shiftKey=a.shiftKey;this.metaKey=
         a.metaKey;this.pointerId=a.pointerId||0;this.pointerType="string"===typeof a.pointerType?a.pointerType:tb[a.pointerType]||"";this.b=a;a.defaultPrevented&&this.c()}}ka(V,sb);var ub=[1,4,2],tb={2:"touch",3:"pen",4:"mouse"};V.prototype.c=function(){V.l.c.call(this);var a=this.b;if(a.preventDefault)a.preventDefault();else if(a.returnValue=!1,qb)try{if(a.ctrlKey||112<=a.keyCode&&123>=a.keyCode)a.keyCode=-1}catch(b){}};var vb="closure_listenable_"+(1E6*Math.random()|0),wb=0;function xb(a,b,c,d,e){this.listener=a;this.a=null;this.src=b;this.type=c;this.capture=!!d;this.b=e;this.key=++wb;this.h=this.i=!1}function yb(a){a.h=!0;a.listener=null;a.a=null;a.src=null;a.b=null};function zb(a){this.src=a;this.a={};this.b=0}zb.prototype.add=function(a,b,c,d,e){var f=a.toString();a=this.a[f];a||(a=this.a[f]=[],this.b++);var g;a:{for(g=0;g<a.length;++g){var h=a[g];if(!h.h&&h.listener==b&&h.capture==!!d&&h.b==e)break a}g=-1}-1<g?(b=a[g],c||(b.i=!1)):(b=new xb(b,this.src,f,!!d,e),b.i=c,a.push(b));return b};var Ab="closure_lm_"+(1E6*Math.random()|0),Bb={},Cb=0;function Db(a,b,c,d,e){if(d&&d.once)return Eb(a,b,c,d,e);if("array"==m(b)){for(var f=0;f<b.length;f++)Db(a,b[f],c,d,e);return null}c=Fb(c);return a&&a[vb]?a.a(b,c,ia(d)?!!d.capture:!!d,e):Gb(a,b,c,!1,d,e)}
         function Gb(a,b,c,d,e,f){if(!b)throw Error("Invalid event type");var g=ia(e)?!!e.capture:!!e,h=Hb(a);h||(a[Ab]=h=new zb(a));c=h.add(b,c,d,g,f);if(c.a)return c;d=Ib();c.a=d;d.src=a;d.listener=c;if(a.addEventListener)rb||(e=g),void 0===e&&(e=!1),a.addEventListener(b.toString(),d,e);else if(a.attachEvent)a.attachEvent(Jb(b.toString()),d);else if(a.addListener&&a.removeListener)a.addListener(d);else throw Error("addEventListener and attachEvent are unavailable.");Cb++;return c}
         function Ib(){var a=Kb,b=pb?function(c){return a.call(b.src,b.listener,c)}:function(c){c=a.call(b.src,b.listener,c);if(!c)return c};return b}function Eb(a,b,c,d,e){if("array"==m(b)){for(var f=0;f<b.length;f++)Eb(a,b[f],c,d,e);return null}c=Fb(c);return a&&a[vb]?a.b(b,c,ia(d)?!!d.capture:!!d,e):Gb(a,b,c,!0,d,e)}
         function Lb(a){if("number"!==typeof a&&a&&!a.h){var b=a.src;if(b&&b[vb])b.c(a);else{var c=a.type,d=a.a;b.removeEventListener?b.removeEventListener(c,d,a.capture):b.detachEvent?b.detachEvent(Jb(c),d):b.addListener&&b.removeListener&&b.removeListener(d);Cb--;if(c=Hb(b)){d=a.type;if(d in c.a){var e=c.a[d],f=Da(e,a),g;(g=0<=f)&&Array.prototype.splice.call(e,f,1);g&&(yb(a),0==c.a[d].length&&(delete c.a[d],c.b--))}0==c.b&&(c.src=null,b[Ab]=null)}else yb(a)}}}
         function Jb(a){return a in Bb?Bb[a]:Bb[a]="on"+a}function Mb(a,b,c,d){var e=!0;if(a=Hb(a))if(b=a.a[b.toString()])for(b=b.concat(),a=0;a<b.length;a++){var f=b[a];f&&f.capture==c&&!f.h&&(f=Nb(f,d),e=e&&!1!==f)}return e}function Nb(a,b){var c=a.listener,d=a.b||a.src;a.i&&Lb(a);return c.call(d,b)}
         function Kb(a,b){if(a.h)return!0;if(!pb){if(!b)a:{b=["window","event"];for(var c=l,d=0;d<b.length;d++)if(c=c[b[d]],null==c){b=null;break a}b=c}d=b;b=new V(d,this);c=!0;if(!(0>d.keyCode||void 0!=d.returnValue)){a:{var e=!1;if(0==d.keyCode)try{d.keyCode=-1;break a}catch(g){e=!0}if(e||void 0==d.returnValue)d.returnValue=!0}d=[];for(e=b.a;e;e=e.parentNode)d.push(e);a=a.type;for(e=d.length-1;0<=e;e--){b.a=d[e];var f=Mb(d[e],a,!0,b);c=c&&f}for(e=0;e<d.length;e++)b.a=d[e],f=Mb(d[e],a,!1,b),c=c&&f}return c}return Nb(a,
         new V(b,this))}function Hb(a){a=a[Ab];return a instanceof zb?a:null}var Ob="__closure_events_fn_"+(1E9*Math.random()>>>0);function Fb(a){if("function"==m(a))return a;a[Ob]||(a[Ob]=function(b){return a.handleEvent(b)});return a[Ob]};function W(a){U.call(this);this.g=a;this.c={}}ka(W,U);var Pb=[];function Qb(a){Ea(a.c,function(b,c){this.c.hasOwnProperty(c)&&Lb(b)},a);a.c={}}W.prototype.f=function(){W.l.f.call(this);Qb(this)};W.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented");};function Rb(a){U.call(this);this.c=a||document.body;this.g=new W(this);a=ja(nb,this.g);this.b?a():(this.a||(this.a=[]),this.a.push(a));a=this.g;var b=this.c,c=this.j,d="click";"array"!=m(d)&&(d&&(Pb[0]=d.toString()),d=Pb);for(var e=0;e<d.length;e++){var f=Db(b,d[e],c||a.handleEvent,!1,a.g||a);if(!f)break;a.c[f.key]=f}}k(Rb,U);
         Rb.prototype.j=function(a){if((ob?0==a.b.button:"click"==a.type||a.b.button&ub[0])&&!(db&&eb&&a.ctrlKey)&&!a.f)for(var b=a.target;b&&b!=this.c;){if(b.tagName&&"a"==b.tagName.toLowerCase()){var c=b.getAttribute("href")||b.getAttributeNS("http://www.w3.org/1999/xlink","href"),d=c;try{var e=void 0,f=Aa(c)[3];e=null==f?null:f;var g;if(g="www.google.com"===ya(e,!0)){var h=Aa(c)[5];g="/url"===ya(h,!0)}if(g){var r=Ba(c,"q");d=r?r:Ba(c,"url")}}catch(R){a:{e=R;if(null!=e){var n=e.s;if(null!=n){R=n;break a}}if(e instanceof
         TypeError){var C=n=new ua,Ca=t(e);C.b=!0;C.g=Ca;pa(C);n.c="__noinit__";n.c=e;n.f(new TypeError(n));e=n}else C=n=new x,Ca=t(e),C.b=!0,C.g=Ca,pa(C),n.c="__noinit__",n.c=e,n.f(Error(n)),e=n;R=e}if(!(R instanceof qa))throw R.a;}d=null!=d?d:"";if(c!=d){h=void 0;b={target:"_blank",noreferrer:!0};c=window;d instanceof y?f=d:(f="undefined"!=typeof d.href?d.href:String(d),f instanceof y||(f="object"==typeof f&&f.b?f.a():String(f),Ra.test(f)||(f="about:invalid#zClosurez"),f=new y(Oa,f)));g=b.target||d.target;
         r=[];for(h in b)switch(h){case "width":case "height":case "top":case "left":r.push(h+"="+b[h]);break;case "target":case "noopener":case "noreferrer":break;default:r.push(h+"="+(b[h]?1:0))}h=r.join(",");if((A("iPhone")&&!A("iPod")&&!A("iPad")||A("iPad")||A("iPod"))&&c.navigator&&c.navigator.standalone&&g&&"_self"!=g)h="A",r=document,h=String(h),"application/xhtml+xml"===r.contentType&&(h=h.toLowerCase()),r=h=r.createElement(h),f instanceof y||f instanceof y||(f="object"==typeof f&&f.b?f.a():String(f),
         Ra.test(f)||(f="about:invalid#zClosurez"),f=new y(Oa,f)),r.href=Qa(f),h.setAttribute("target",g),b.noreferrer&&h.setAttribute("rel","noreferrer"),b=document.createEvent("MouseEvent"),b.initMouseEvent("click",!0,!0,c,1),h.dispatchEvent(b);else if(b.noreferrer){if(c=c.open("",g,h),b=Qa(f),c&&(bb&&-1!=b.indexOf(";")&&(b="'"+b.replace(/'/g,"%27")+"'"),c.opener=null,Ma.test(b)&&(-1!=b.indexOf("&")&&(b=b.replace(Ga,"&amp;")),-1!=b.indexOf("<")&&(b=b.replace(Ha,"&lt;")),-1!=b.indexOf(">")&&(b=b.replace(Ia,
         "&gt;")),-1!=b.indexOf('"')&&(b=b.replace(Ja,"&quot;")),-1!=b.indexOf("'")&&(b=b.replace(Ka,"&#39;")),-1!=b.indexOf("\x00")&&(b=b.replace(La,"&#0;"))),f=new B,f.c='<meta name="referrer" content="no-referrer"><meta http-equiv="refresh" content="0; url='+b+'">',b=f,c=c.document))c.write(Va(b)),c.close()}else(c=c.open(Qa(f),g,h))&&b.noopener&&(c.opener=null);a.c();break}}b=b.parentNode}};function Sb(a){new Rb(a)}var X=["DOCS_installLinkReferrerSanitizer"],Y=l;
         X[0]in Y||"undefined"==typeof Y.execScript||Y.execScript("var "+X[0]);for(var Z;X.length&&(Z=X.shift());)X.length||void 0===Sb?Y[Z]&&Y[Z]!==Object.prototype[Z]?Y=Y[Z]:Y=Y[Z]={}:Y[Z]=Sb;}).call(this);
      </script><script type="text/javascript" nonce="">DOCS_installLinkReferrerSanitizer();</script>
      <div></div>
   </body>
</html>
